<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>text.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs-comment{color:#969896}.css .hljs-class,.css .hljs-id,.css .hljs-pseudo,.hljs-attribute,.hljs-regexp,.hljs-tag,.hljs-variable,.html .hljs-doctype,.ruby .hljs-constant,.xml .hljs-doctype,.xml .hljs-pi,.xml .hljs-tag .hljs-title{color:#c66}.hljs-built_in,.hljs-constant,.hljs-literal,.hljs-number,.hljs-params,.hljs-pragma,.hljs-preprocessor{color:#de935f}.css .hljs-rules .hljs-attribute,.ruby .hljs-class .hljs-title{color:#f0c674}.hljs-header,.hljs-inheritance,.hljs-string,.hljs-value,.ruby .hljs-symbol,.xml .hljs-cdata{color:#b5bd68}.css .hljs-hexcolor,.hljs-title{color:#8abeb7}.coffeescript .hljs-title,.hljs-function,.javascript .hljs-title,.perl .hljs-sub,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword{color:#81a2be}.hljs-keyword,.javascript .hljs-function{color:#b294bb}.hljs{display:block;overflow-x:auto;background:#1d1f21;color:#c5c8c6;padding:.5em;-webkit-text-size-adjust:none}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:2px;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:2px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:1em}.MathJax_MenuRadioCheck.RTL{right:1em;left:auto}.MathJax_MenuLabel{padding:2px 2em 4px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #CCC;margin:4px 1px 0}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:Highlight;color:HighlightText}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="вариант-5"><a name="вариант-5" href="#вариант-5"></a>Вариант 5</h1><h2 id="1-начало-работы"><a name="1-начало-работы" href="#1-начало-работы"></a>1 Начало работы</h2><blockquote>
<p><strong>Примечание:</strong><br>код и используемые ниже подходы зачастую не стоит брать как хороший пример для реальных проектов,<br>все написано так,  чтобы побыстрее и попроще выполнить задание на экзамене.</p>
</blockquote><p>Внимательно изучите содержимое каталогов. Прочитайте файл с заданием “Сессия1”. Выпишите все функции (задачи) на листок бумаги или в текстовый документ. Потратив время на описание всех функций, вы уменьшите шанс того, что что-нибудь просто напросто забудете.</p><p>Примерный вид (во время экзамена вы можете описать все менее детально, учитывайте дефицит времени. Так или иначе вам все равно придется вовзращаться к тексту задания):</p><ul>
<li>восстановление базы из скрипта;</li><li>нормализация базы данных, создание новых таблиц и связей;</li><li>импорт данных;<br>— импорт товаров;<br>— импорт заказов;<br>— импорт пользователей;</li><li>окно авторизации;<br>— проверка логина и пароля;<br>— реализация входа по ролям;<br>— передача информации о пользователе в окно (вывод ФИО);<br>— вход в гостевом режиме;<br>— CAPTCHA (буквы и цифры, не в ряд, зачернуты или шум);<br>— блокировка на 10 секунд при неудачном входе с использование CAPTCHA;</li><li>список товаров;<br>— вывод товаров;<br>— соответствие макету;<br>— поиск товара (по нескольким аттрибутам);<br>— сортировка (по убыванию или возрастанию стоимости);<br>— фильтр по производителю (в списке первым пунктом идет “все производители”);<br>— совместная работа фильтров;<br>— вывод количества записей (N из M записей);<br>— удаление товара (товар, который есть в заказе удалить нельзя; товар удаляется вместе с допонительными товарами);<br>— переход на окно добавления;<br>— переход на окно изменения;</li><li>добавление и редактирование;<br>— доступно только администратору;<br>— поля (наименование, категория (выпадающий список), количество на складе, единица измерения, поставщик, стоимость за единицу, изображение и подробное описание (с возможностью многострочного ввода))<br>— стоимость не может быть отрицательной, выводится с точностью до сотых;<br>— минимальное количество не может быть отрицательным;<br>— при открытии формы для редактирования все поля выбранного объекта должны быть подгружены в соответствующие поля из базы данных;<br>— ID товара при добавлении не отображается, автоматически вычисляется +1 к имеющемуся в БД, при редактировании ID доступно только для чтения;<br>— изменение изображение товара (сразу отображается, максимальный размер 300х200 пикселей);<br>— при замене изображения, старое будет удалено из папки;<br>— значения в списке должны автоматически обновляться;</li><li>разработка библиотеки;<br>— название библиотеки;<br>— имя класса;<br>— сигнатура метода;<br>— алгоритм;</li><li>разработка юнит-тестов;<br>— создание проекта;<br>— задание зависимости;<br>— написание тестов (имена тестов, логика тестов);</li><li>ручное тестирование;</li><li>5 сценариев по шаблону, тестирование добавления товара;</li><li>сохранение;<br>— сохранение файлов;<br>— создание readme.md</li></ul><h2 id="2-база-данных"><a name="2-база-данных" href="#2-база-данных"></a>2 База данных</h2><h3 id="2.1-восстановление-бд"><a name="2.1-восстановление-бд" href="#2.1-восстановление-бд"></a>2.1 Восстановление БД</h3><p>Выполните сохранение базы из скрипта. Для этого, сперва авторизуйтесь на сервере (используем SSMS). Далее, вы можете открыть файл скрипта (с помощью соответствующего пункта меню или drag-n-drop).</p><p>В зависиомости от рабочего места и используемого сервера у вас может быть доступ ко всем БД или к конкретно вашей. Так или иначе, убедитесь, что вы работаете с правильной базой данных. Вероятно, что вам придется изменить некоторые инструкции в скрипте (вроде <code>CREATE</code> или <code>USE</code> )<br><img src="1.png" alt=""><br><img src="2.png" alt=""></p><p>По нажатию на кнопку “выполнить” вы добъетесь выполнения скрипта. Обратите внимание: чтобы обновить значения в окне “обозреватель объектов”, вам придется нажать на кнопку “обновить”.<br>Создейте диаграмму БД (ПКМ по “Диграммы баз данных”, создать диаграмму).<br><img src="3.png" alt=""></p><p>Для изменения полей таблиц вы можете поступить двумя способами. Первый - использовать “проектирование”:<br><img src="4.png" alt=""></p><p>Второй - можно редактировать поля прямо на диаграмме:</p><h2 id="![](5.png)"><a name="![](5.png)" href="#![](5.png)"></a><img src="5.png" alt=""></h2><p><img src="6.png" alt=""></p><p>Для ускорения процесса проектирования будем все проделывать прямо на диаграмме. В обычной ситуации (не на экзмене), лучше не торопиться и работать через “проектирование”.</p><h3 id="2.2-анализ-и-импорт-таблиц"><a name="2.2-анализ-и-импорт-таблиц" href="#2.2-анализ-и-импорт-таблиц"></a>2.2 Анализ и импорт таблиц</h3><p>Самое время проанализировать задание, файлы для импорта, и сопоставить их с существующей базой данных.<br>Пользователи:<br><img src="7.png" alt=""></p><p>В базе данных мы имеем практически те же самые поля, однако:</p><ul>
<li>ФИО нужно разбить на три столбца;</li><li>роль сотрудника нужно вынести в отдельную таблицу;</li></ul><p>Первая проблема решается с помощью функции Excel “текст по столбцам” (или как-то так). Вам придется разобраться с ней самостоятельно, так как на моей машине нет MS Office.</p><p>В LibreOffice это выглядит примерно так (в Excel будет все очень похоже):<br><img src="8.png" alt=""><br><img src="9.png" alt=""><br><img src="10.png" alt=""></p><p>Вторая проблема решается следующим образом. Сперва определим все роли. Если ролей и записей немного, то мы можем это сделать просто посмотрев на таблицу. Если записей достаточно много, то лучше скопировать значения из столбца в другое место и воспользоваться функцией Excel “данные -&gt; удалить дубликаты”.</p><p>В принципе, мы сразу же видим, что роли всего три (плюс, что даже важнее, об этом можно прочитать в задании). Добавим роли в таблицу Role вручную (SSMS, использовать “изменить первые 200 строк”):<br><img src="12.png" alt=""><br><img src="11.png" alt=""></p><p>Далее, с помощью “поиск и замена” (CTRL-F), выполним замены по столбцу (заменяйте роли на тот Id, который сгенерировался <strong>у вас</strong>, у меня идентификаторы попали на числа 1, 2 и 3).<br><img src="13.png" alt=""><br><img src="14.png" alt=""></p><p>Чтобы быстро импортировать данные, используем простое копирование из Excel.<br>Сперва откройте окно изменения записей (таблица User)<br><img src="15.png" alt=""></p><p>Далее, добейтесь того, чтобы столбцы в Excel совпадали со столбцами в БД:<br><img src="16.pnG" alt=""></p><p>Выделите диапазон вместе с предполагаемым полем Id (из-за автоинкремента вставка в первый столбец будет недоступна, но мы все равно должны его учесть).<br><img src="17.png" alt=""></p><p>Выполните вставку в SSMS, предварительно выделив запись:<br><img src="18.png" alt=""><br><img src="19.png" alt=""></p><p>Следующей таблицей выберем товары.<br><img src="20.png" alt=""></p><p>Проанализировав таблицу в БД и задание, мы можем отметить следующее:</p><ul>
<li>артикул выступает первичным ключом, но по заданию должен быть ID, увеличивающийся на единицу;</li><li>в БД отсутствует поле с единицей измерения;</li><li>в БД отсутствует поле с поставщиками;</li><li>в БД отсутствует поле с максимальной скидкой; </li><li>производителей, категории товара и единицы измерения следует вынести в отдельные таблицы;</li><li>поле с изображением имеет бинарный тип image, по заданию же необходимо хранить путь до файла;</li></ul><p>Изменим первичный ключ.<br>Сперва добавим поле (через диаграмму, ПКМ -&gt; вставить столбец):<br><img src="21.png" alt=""></p><p>Затем удалим старый первичный ключ (ПКМ по полю ProductArcticle -&gt; удалить первичный ключ; при этом будет удалена связь с таблицей OrderProduct!)<br><img src="22.png" alt=""></p><p>Зададим новый первичный ключ (ПКМ -&gt; задать первичный ключ) и установим автоинкремент (через свойства поля, ПКМ -&gt; свойства):<br><img src="23.png" alt=""></p><p>Добавим единицы измерения. Cоздадим отдельную таблицу, зададим ей первичный ключ и автоинкремент<br><img src="24.png" alt=""><br><img src="25.pnG" alt=""></p><p>Добавим существующие единицы измерения:<br><img src="26.png" alt=""></p><p>Выполним замену в файле для импорта:<br><img src="27.png" alt=""></p><p>Создадим поле в таблице с продуктами:<br><img src="28.png" alt=""></p><p>Добавим связь. Для этого можно просто “взять” мышкой поле <code>ProductUnit</code> и перетащить его на таблицу <code>Unit</code><br><img src="29.png" alt=""><br>а затем задать внешний ключ<br><img src="30.png" alt=""><br><img src="31.png" alt=""></p><p><strong>Самостоятельно</strong> проделайте похожие действия с производителями и категориями. А именно:</p><ul>
<li>создайте отдельные таблицы <code>Manufacturer</code> и <code>Category</code>, задайте первичные ключи и поля с названиями;</li><li>добавьте в базу всех производителей и категории из файла для импорта (используйте удаление дубликатов или просмотрите таблицу вручную);</li><li>с помощью поиска и замены выполните замену всех названий категорий и производителей на идентификаторы (в файле с данными для импорта);</li><li>задайте связь между таблицами.</li></ul><p>Примерный результат:<br><img src="32.png" alt=""><br><img src="33.png" alt=""><br><img src="34.png" alt=""><br><img src="35.pNg" alt=""></p><p><strong>Самостоятельно</strong> добавьте таблицу поставщиков, выполнив действия, указанные выше, еще раз.<br><img src="36.png" alt=""><br><img src="37.png" alt=""><br><img src="38.png" alt=""></p><p>После нормализации данных (успешного создания всех таблиц и связей), наша следующая проблема - поле Image. При попытке изменить его на nvarchar можно увидеть следующее сообщение:<br><img src="39.png" alt=""></p><p>Решение является очень простым: нужно удалить поле и создать его снова, указав при этом тип nvarchar.</p><p>Также, на забудьте про поле <code>ProductMaxDiscountAmount</code> (максимальная скидка).</p><p>Последняя проблема - поле <code>ProductStatus</code>. Здесь имеется подстава от авторов задания. Дело в том, что в задании или ресурсах мне не удалось найти никакой информации о статусах продуктов. При этом есть критерий, связанный с проверкой наличия данного поля в окне добавления (а по заданию такое поле не требуется!). В общем, предложение следующее: просто удалить это поле как ненужное. Надеемся, что таких неточностей в задании в будущем не возникнет.</p><p>Когда все будет наконец готово, выполните копирование значений из таблицы в БД (по аналогии с импортом пользователей):</p><ul>
<li>сперва приведите в соответствие порядок полей;</li><li>затем выполните копирование и вставку в окно “изменить первые 200 записей”;</li></ul><p>Кстати, если не хотите двигать поля в excel, никто не мешает изменить порядок полей в SSMS.</p><p><img src="40.PNG" alt=""></p><p>Последняя таблица - таблица с заказами.<br><img src="41.png" alt=""></p><p>Сразу бросается в глаза следующее:</p><ul>
<li>статус заказа следует вынести в отдельную таблицу;</li><li>клиента следует задать через связь с таблицей user;</li><li>необходимо имортировать пункты выдачи;</li><li>состав заказа следует реализовать через промежуточную таблицу <code>OrderProduct</code>;</li><li>не хватает даты заказа (есть только дата доставки) и кода получения;</li></ul><p>Начнем с импорта пунктов выдачи.<br><img src="42.png" alt=""></p><p>В принципе, вы легко можете разбить адрес с помощью функции “текст по столбцам”. Я этого делать не буду и просто оставлю все как есть.</p><p>Создаем таблицу для пунктов выдачи, определяем необходимые поля и добавляем связь.<br><img src="43.png" alt=""></p><p>С помощью обычного копирвания импортируем данные в таблицу.<br><img src="44.png" alt=""></p><p>Если у вас, как и у меня, идентификаторы идут не с единицы, и вам нужно изменить их значения, вы можете просто выполнить SQL-запрос:</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>-- вместо 10000 вы можете подогнать ваше число
UPDATE PickupPoint SET PickupPointId = PickupPointId - 10000;
</code></pre>"><span class="hljs-comment">-- вместо 10000 вы можете подогнать ваше число</span>
<span class="hljs-operator"><span class="hljs-keyword">UPDATE</span> PickupPoint <span class="hljs-keyword">SET</span> PickupPointId = PickupPointId - <span class="hljs-number">10000</span>;</span>
</code></pre><p>Со статусами заказов вы уже знаете что делать и легко справитесь <strong>самостоятельно</strong>.<br><img src="45.png" alt=""></p><p>Далее, добавим отношение между таблицами <code>Order</code> и <code>User</code>:<br><img src="46.png" alt=""><br>И сразу же изменим значения в файле для импорта:<br><img src="47.png" alt=""></p><p>Последнее, что осталось - это состав заказа. Сперва будет удобным вынести информацию на отдельный лист<br><img src="48.png" alt=""></p><p>Далее, с помощью “текст по столбцам” и других функций Excel добейтесь, чтобы ваши данные были преобразованы к следующему виду:<br><img src="49.png" alt=""></p><p>В принципе, мы можем заменить товары на их Id с помощью все той же замены, но что делать если записей будет очень много?</p><p>Решением может быть использование функции Excel ВПР. Сперва подготовим таблицу для поиска. Выполним с помощью SSMS запрос:</p><pre class="sql hljs"><code class="sql" data-origin="<pre><code class=&quot;sql&quot;>SELECT ProductArticleNumber, ProductId FROM Product
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> ProductArticleNumber, ProductId <span class="hljs-keyword">FROM</span> Product
</span></code></pre><p><img src="50.png" alt=""></p><p>Полученные значения вставим в Excel<br><img src="51.png" alt=""></p><p>В ячейке J2 (ну или где-нибудь правее, как вам удобнее) напишем формулу <code>=A2</code> (значение из столбца Заказ)<br>В ячейке L2 (через одну) напишем <code>=C2</code>(значение из столбца Количество)<br>В ячейке K2 (между ними) нажмем на мастер функций:<br><img src="52.png" alt=""><br>В окне выбора функции найдем функцию ВПР и выберем ее. Далее, следует задать следуюшее (в Excel названия могут отличаться по сравнению с моей программой):</p><ul>
<li>критерий поиска (какое значение искать);</li><li>таблица для поиска (где искать);</li><li>номер столбца в таблице для получения результата (что выбрать из таблицы в случае успеха);</li><li>является ли диапазон отсортированным (в нашем случае ЛОЖЬ. Вообще, лучше искать по отсортированным диапазонам, но мы просто экономим время)</li></ul><p>В критерии поиска указываем артикул. В таблице для поиска указывам диапазон, содержащий информацию о продуктах (так как мы ищем по артиклу, он должен быть в этом диапазоне первым столбцом). Номер столбца берем 2 (второй столбец содержит Id, нумерация здесь с единицы).<br><img src="53.png" alt=""></p><p>После написания формулы раскопируем значения:<br><img src="54.png" alt=""></p><p>Полученные справа числа мы сможем вставить в таблицу <code>OrderProduct</code>.</p><p>Осталось еще немного изменить саму таблицу <code>Order</code>:</p><ul>
<li>изменим поле с <code>ProductArticleNumber</code> на <code>ProductId</code> типа int;</li><li>создадим связь между <code>OrderProduct</code> и <code>Product</code>;</li><li>если пропал первичный ключ (скорее всего это не случилось), то нужно задать составной первичный ключ, для этого вам нужно выделить оба поля <code>OrderId</code> и <code>ProductId</code>, после чего добавить первичный ключ (ключик будет нарисован рядом с обоими полями, уникальным становится не отдельное значение <code>OrderId</code> или <code>ProductId</code>, а их пара).<br>Примерный результат:<br><img src="55.png" alt=""></li></ul><p>Последний штрих - добавим поле <code>OrderDate</code> типа <code>DateTime</code> и поле <code>OrderCode</code> типа <code>int</code>:<br><img src="56.pnG" alt=""></p><p>Наконец, можно начать сам импорт. Упорядочим столбцы (вам нужно упорядочить под свои полученные поля):<br><img src="57.png" alt=""></p><p>Выполним копирование:<br><img src="58.png" alt=""></p><p>После этого можно вставить полученные ранее значения для <code>OrderProduct</code>:<br><img src="59.pnG" alt=""></p><p>Готово! Мы завершили проектирование БД и выполнили импорт данных.</p><p><img src="60.png" alt=""></p><h2 id="3.-создание-приложения"><a name="3.-создание-приложения" href="#3.-создание-приложения"></a>3. Создание приложения</h2><h3 id="3.1-начальные-приготовления"><a name="3.1-начальные-приготовления" href="#3.1-начальные-приготовления"></a>3.1 Начальные приготовления</h3><p>Создайте проект WPF (Майкрософт). Выберите последнюю доступную версию платформы .Net. Проект нужно назвать по названию организации (см. файл требования и рекомендации). Я назову свой проект <code>Tkani</code>.</p><p>Выполните установку пакетов с помощью NuGet:</p><pre><code data-origin="<pre><code>Microsoft.EntityFrameworkCore
Microsoft.EntityFrameworkCore.Tools
Microsoft.EntityFrameworkCore.SqlServer
</code></pre>">Microsoft.EntityFrameworkCore
Microsoft.EntityFrameworkCore.Tools
Microsoft.EntityFrameworkCore.SqlServer
</code></pre><p><img src="61.png" alt=""></p><p>Далее, откройте консоль диспетчера пакетов NuGet и напишите команду:</p><pre><code data-origin="<pre><code>Scaffold-DbContext &quot;ВАША СТРОКА ПОДКЛЮЧЕНИЯ&quot; Microsoft.EntityFrameworkCore.SqlServer -out Models
</code></pre>">Scaffold-DbContext "ВАША СТРОКА ПОДКЛЮЧЕНИЯ" Microsoft.EntityFrameworkCore.SqlServer -out Models
</code></pre><p>В кавычках вам следует написать строку подключения. У меня это будет <code>"Server = (localdb)\MSSQLLocalDB; Database = Tkani; Integrated Security = true"</code>. У вас же строка может отличаться. В случае с локальной базой <code>Tkani</code> подойдет моя строка. В случае с базой на удаленном сервере ваша строка может иметь вид <code>"Server = 192.168.200.247; Database = Student21; User Id = Student21; Password=mymegapassword"</code>.</p><p>Выполните команду. Если все было проделано правильно, то будет сгенерирована папка Models со всеми необходимыми классами.<br><img src="62.png" alt=""></p><p>Сразу же вынесем <code>MainWindow</code> в каталог <code>Views</code>:<br><img src="63.png" alt=""></p><p>После этого переименуем окно в <code>LoginWindow</code>.</p><p>Запустите приложение. Возникнет ошибка. Исправим ее, изменив <code>StartupUri</code> в файле <code>App.xaml</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Application x:Class=&quot;Tkani.App&quot;
             ...
             StartupUri=&quot;Views/LoginWindow.xaml&quot;&amp;gt;
    &amp;lt;Application.Resources&amp;gt;
...
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Application</span> <span class="hljs-attribute">x:Class</span>=<span class="hljs-value">"Tkani.App"</span>
             <span class="hljs-attribute">...</span>
             <span class="hljs-attribute">StartupUri</span>=<span class="hljs-value">"Views/LoginWindow.xaml"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Application.Resources</span>&gt;</span>
...
</code></pre><p>Сразу зададим иконку из ресурсов (она имеет расширение ico). Для этого следует нажать ПКМ по проекту, выбрать пункт Свойства. В окне свойств нужно найти пункт “Значок” и выбрать соответствующий файл.<br><img src="64.png" alt=""></p><h3 id="3.2-окно-авторизации"><a name="3.2-окно-авторизации" href="#3.2-окно-авторизации"></a>3.2 Окно авторизации</h3><p>Разработаем окно авторизации.<br>Сперва добавим логотип<br><img src="65.png" alt=""><br>и установим его как ресурс<br><img src="66.png" alt=""></p><p>Окну установим <code>WindowStyle="ToolWindow"</code> и <code>ResizeMode="NoResize"</code>. Зададим размеры 400x500. </p><p>Основным компоновочным элементом возьмем <code>Grid</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Grid VerticalAlignment=&quot;Center&quot; Margin=&quot;10 0&quot;&amp;gt;
    &amp;lt;Grid.RowDefinitions&amp;gt;
        &amp;lt;RowDefinition Height=&quot;180&quot; /&amp;gt;
        &amp;lt;RowDefinition Height=&quot;auto&quot; /&amp;gt;
    &amp;lt;/Grid.RowDefinitions&amp;gt;
    &amp;lt;Image Source=&quot;./../Images/logo.png&quot; HorizontalAlignment=&quot;Center&quot; /&amp;gt;
    &amp;lt;StackPanel Grid.Row=&quot;1&quot;&amp;gt;
        ...
    &amp;lt;/StackPanel&amp;gt;
&amp;lt;/Grid&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Grid</span> <span class="hljs-attribute">VerticalAlignment</span>=<span class="hljs-value">"Center"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"10 0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Grid.RowDefinitions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">RowDefinition</span> <span class="hljs-attribute">Height</span>=<span class="hljs-value">"180"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">RowDefinition</span> <span class="hljs-attribute">Height</span>=<span class="hljs-value">"auto"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Grid.RowDefinitions</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Image</span> <span class="hljs-attribute">Source</span>=<span class="hljs-value">"./../Images/logo.png"</span> <span class="hljs-attribute">HorizontalAlignment</span>=<span class="hljs-value">"Center"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">StackPanel</span> <span class="hljs-attribute">Grid.Row</span>=<span class="hljs-value">"1"</span>&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-title">StackPanel</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Grid</span>&gt;</span>
</code></pre><p>Первая строка будет содержать изображение, вторая строка будет содержать <code>StackPanel</code> с полями ввода. </p><p>Добавим внутрь <code>StackPanel</code> сами поля ввода:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Label Content=&quot;Имя пользователя&quot; /&amp;gt;
&amp;lt;TextBox /&amp;gt;
&amp;lt;Label Content=&quot;Пароль&quot; /&amp;gt;
&amp;lt;PasswordBox /&amp;gt;
&amp;lt;StackPanel Margin=&quot;0 10 0 25&quot;&amp;gt;
    &amp;lt;StackPanel HorizontalAlignment=&quot;Center&quot; Orientation=&quot;Horizontal&quot;&amp;gt;
        &amp;lt;TextBlock Text=&quot;1A&quot; x:Name=&quot;captchaFirstBlock&quot;
                   TextDecorations=&quot;Strikethrough&quot; Margin=&quot;0 5 10 0&quot; /&amp;gt;
        &amp;lt;TextBlock Text=&quot;z8&quot; x:Name=&quot;captchaSecondBlock&quot;
                   TextDecorations=&quot;Strikethrough&quot; /&amp;gt;
    &amp;lt;/StackPanel&amp;gt;
    &amp;lt;TextBlock Text=&quot;Введите текст с картинки:&quot; /&amp;gt;
    &amp;lt;TextBox /&amp;gt;
&amp;lt;/StackPanel&amp;gt;
&amp;lt;Button Content=&quot;Вход в систему&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Имя пользователя"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Пароль"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">PasswordBox</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">StackPanel</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"0 10 0 25"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">StackPanel</span> <span class="hljs-attribute">HorizontalAlignment</span>=<span class="hljs-value">"Center"</span> <span class="hljs-attribute">Orientation</span>=<span class="hljs-value">"Horizontal"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"1A"</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaFirstBlock"</span>
                   <span class="hljs-attribute">TextDecorations</span>=<span class="hljs-value">"Strikethrough"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"0 5 10 0"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"z8"</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaSecondBlock"</span>
                   <span class="hljs-attribute">TextDecorations</span>=<span class="hljs-value">"Strikethrough"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">StackPanel</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"Введите текст с картинки:"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">StackPanel</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Вход в систему"</span> /&gt;</span>
</code></pre><p>Элементы, связанные с captcha мы разместили в отдельный контейнер (еще одна <code>StackPanel</code>), чтобы их было проще спрятать или показать (достаточно будет просто задать <code>Visibility</code> всему контейнеру).</p><p>При запуске, на данном этапе, окно выглядит примерно следующим образом:<br><img src="67.png" alt=""></p><p>Чтобы сделать его более симпатичным мы обратимся к руководству по стилю и опишем ресурсы в файле app.xaml.</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;!--Цвета--&amp;gt;
&amp;lt;SolidColorBrush x:Key=&quot;BackgroudColor&quot; Color=&quot;#FFFFFF&quot; /&amp;gt;
&amp;lt;SolidColorBrush x:Key=&quot;AdditionalColor&quot; Color=&quot;#76E383&quot; /&amp;gt;
&amp;lt;SolidColorBrush x:Key=&quot;AccentColor&quot; Color=&quot;#498C51&quot; /&amp;gt;
&amp;lt;!--Шрифт--&amp;gt;
&amp;lt;Style TargetType=&quot;Window&quot;&amp;gt;
    &amp;lt;!-- Сами Window и Page имеют свойство FontFamily --&amp;gt;
    &amp;lt;!-- Это самый быстрый способ задать шрифт для множества элементов, --&amp;gt;
    &amp;lt;!-- но при таком подходе надо быть внимательней --&amp;gt;
    &amp;lt;Setter Property=&quot;FontFamily&quot; Value=&quot;Comic Sans MS&quot; /&amp;gt;
&amp;lt;/Style&amp;gt;
&amp;lt;!--Кнопки--&amp;gt;
&amp;lt;Style TargetType=&quot;Button&quot; &amp;gt;
    &amp;lt;Setter Property=&quot;Padding&quot; Value=&quot;5&quot; /&amp;gt;
    &amp;lt;Setter Property=&quot;Background&quot; Value=&quot;{StaticResource AccentColor}&quot; /&amp;gt;
    &amp;lt;Setter Property=&quot;Foreground&quot; Value=&quot;{StaticResource BackgroudColor}&quot; /&amp;gt;
&amp;lt;/Style&amp;gt;
&amp;lt;!--Поля ввода--&amp;gt;
&amp;lt;Style TargetType=&quot;TextBox&quot;&amp;gt;
    &amp;lt;Setter Property=&quot;Padding&quot; Value=&quot;0 5&quot; /&amp;gt;
    &amp;lt;Setter Property=&quot;VerticalContentAlignment&quot; Value=&quot;Center&quot; /&amp;gt;
    &amp;lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;{StaticResource AccentColor}&quot;  /&amp;gt;
    &amp;lt;Setter Property=&quot;Background&quot; Value=&quot;{StaticResource AdditionalColor}&quot; /&amp;gt;
&amp;lt;/Style&amp;gt;
&amp;lt;Style TargetType=&quot;PasswordBox&quot;&amp;gt;
    &amp;lt;Setter Property=&quot;Padding&quot; Value=&quot;0 5&quot; /&amp;gt;
    &amp;lt;Setter Property=&quot;VerticalContentAlignment&quot; Value=&quot;Center&quot; /&amp;gt;
    &amp;lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;{StaticResource AccentColor}&quot;  /&amp;gt;
    &amp;lt;Setter Property=&quot;Background&quot; Value=&quot;{StaticResource AdditionalColor}&quot; /&amp;gt;
&amp;lt;/Style&amp;gt;
</code></pre>"><span class="hljs-comment">&lt;!--Цвета--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">SolidColorBrush</span> <span class="hljs-attribute">x:Key</span>=<span class="hljs-value">"BackgroudColor"</span> <span class="hljs-attribute">Color</span>=<span class="hljs-value">"#FFFFFF"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">SolidColorBrush</span> <span class="hljs-attribute">x:Key</span>=<span class="hljs-value">"AdditionalColor"</span> <span class="hljs-attribute">Color</span>=<span class="hljs-value">"#76E383"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">SolidColorBrush</span> <span class="hljs-attribute">x:Key</span>=<span class="hljs-value">"AccentColor"</span> <span class="hljs-attribute">Color</span>=<span class="hljs-value">"#498C51"</span> /&gt;</span>
<span class="hljs-comment">&lt;!--Шрифт--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Style</span> <span class="hljs-attribute">TargetType</span>=<span class="hljs-value">"Window"</span>&gt;</span><span class="css">
    &lt;!<span class="hljs-tag">--</span> Сами <span class="hljs-tag">Window</span> и <span class="hljs-tag">Page</span> имеют свойство <span class="hljs-tag">FontFamily</span> <span class="hljs-tag">--</span>&gt;
    &lt;!<span class="hljs-tag">--</span> Это самый быстрый способ задать шрифт для множества элементов, <span class="hljs-tag">--</span>&gt;
    &lt;!<span class="hljs-tag">--</span> но при таком подходе надо быть внимательней <span class="hljs-tag">--</span>&gt;
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">FontFamily</span>" <span class="hljs-tag">Value</span>="<span class="hljs-tag">Comic</span> <span class="hljs-tag">Sans</span> <span class="hljs-tag">MS</span>" /&gt;
</span><span class="hljs-tag">&lt;/<span class="hljs-title">Style</span>&gt;</span>
<span class="hljs-comment">&lt;!--Кнопки--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Style</span> <span class="hljs-attribute">TargetType</span>=<span class="hljs-value">"Button"</span> &gt;</span><span class="css">
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">Padding</span>" <span class="hljs-tag">Value</span>="5" /&gt;
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">Background</span>" <span class="hljs-tag">Value</span>="<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">StaticResource AccentColor}" /&gt;
    &lt;Setter Property="Foreground" Value="{StaticResource BackgroudColor}" /&gt;
</span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">Style</span>&gt;</span>
<span class="hljs-comment">&lt;!--Поля ввода--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Style</span> <span class="hljs-attribute">TargetType</span>=<span class="hljs-value">"TextBox"</span>&gt;</span><span class="css">
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">Padding</span>" <span class="hljs-tag">Value</span>="0 5" /&gt;
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">VerticalContentAlignment</span>" <span class="hljs-tag">Value</span>="<span class="hljs-tag">Center</span>" /&gt;
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">BorderBrush</span>" <span class="hljs-tag">Value</span>="<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">StaticResource AccentColor}"  /&gt;
    &lt;Setter Property="Background" Value="{StaticResource AdditionalColor}" /&gt;
</span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">Style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Style</span> <span class="hljs-attribute">TargetType</span>=<span class="hljs-value">"PasswordBox"</span>&gt;</span><span class="css">
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">Padding</span>" <span class="hljs-tag">Value</span>="0 5" /&gt;
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">VerticalContentAlignment</span>" <span class="hljs-tag">Value</span>="<span class="hljs-tag">Center</span>" /&gt;
    &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">BorderBrush</span>" <span class="hljs-tag">Value</span>="<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">StaticResource AccentColor}"  /&gt;
    &lt;Setter Property="Background" Value="{StaticResource AdditionalColor}" /&gt;
</span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">Style</span>&gt;</span>
</code></pre><p>Во время экзамена можете сильно не усердствовать, однако, вам в любом случае нужно будет определить шрифты и цвета.</p><p>Немного изменим разметку окна, добавив элементам имена и скрыв контейнер для captcha:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Window x:Class=&quot;Tkani.LoginWindow&quot;
        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;
        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;
        xmlns:local=&quot;clr-namespace:Tkani&quot;
        mc:Ignorable=&quot;d&quot;
        WindowStyle=&quot;ToolWindow&quot;
        WindowStartupLocation=&quot;CenterScreen&quot;
        Background=&quot;{StaticResource AdditionalColor}&quot;
        ResizeMode=&quot;NoResize&quot;
        Title=&quot;ООО Ткани - Вход в систему&quot; Height=&quot;500&quot; Width=&quot;400&quot;&amp;gt;
    &amp;lt;Grid VerticalAlignment=&quot;Center&quot; Margin=&quot;10 0&quot; &amp;gt;
        &amp;lt;Grid.RowDefinitions&amp;gt;
            &amp;lt;RowDefinition Height=&quot;180&quot; /&amp;gt;
            &amp;lt;RowDefinition Height=&quot;auto&quot; /&amp;gt;
        &amp;lt;/Grid.RowDefinitions&amp;gt;
        &amp;lt;Image Source=&quot;./../Images/logo.png&quot; HorizontalAlignment=&quot;Center&quot; /&amp;gt;
        &amp;lt;StackPanel  Grid.Row=&quot;1&quot;&amp;gt;
            &amp;lt;Label Content=&quot;Имя пользователя&quot; /&amp;gt;
            &amp;lt;TextBox Name=&quot;loginInput&quot; /&amp;gt;
            &amp;lt;Label Content=&quot;Пароль&quot; /&amp;gt;
            &amp;lt;PasswordBox Name=&quot;passwordInput&quot; /&amp;gt;
            &amp;lt;StackPanel Margin=&quot;0 10 0 25&quot; x:Name=&quot;captchaContainer&quot; Visibility=&quot;Ршввут&quot;&amp;gt;
                &amp;lt;StackPanel HorizontalAlignment=&quot;Center&quot; Orientation=&quot;Horizontal&quot;&amp;gt;
                    &amp;lt;TextBlock Text=&quot;1A&quot; x:Name=&quot;captchaFirstBlock&quot;
                               TextDecorations=&quot;Strikethrough&quot; Margin=&quot;0 5 10 0&quot; /&amp;gt;
                    &amp;lt;TextBlock Text=&quot;z8&quot; x:Name=&quot;captchaSecondBlock&quot;
                               TextDecorations=&quot;Strikethrough&quot; /&amp;gt;
                &amp;lt;/StackPanel&amp;gt;
                &amp;lt;TextBlock Text=&quot;Введите текст с картинки:&quot; /&amp;gt;
                &amp;lt;TextBox /&amp;gt;
            &amp;lt;/StackPanel&amp;gt;
            &amp;lt;Button Content=&quot;Вход в систему&quot; /&amp;gt;
        &amp;lt;/StackPanel&amp;gt;
    &amp;lt;/Grid&amp;gt;
&amp;lt;/Window&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">x:Class</span>=<span class="hljs-value">"Tkani.LoginWindow"</span>
        <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        <span class="hljs-attribute">xmlns:x</span>=<span class="hljs-value">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        <span class="hljs-attribute">xmlns:d</span>=<span class="hljs-value">"http://schemas.microsoft.com/expression/blend/2008"</span>
        <span class="hljs-attribute">xmlns:mc</span>=<span class="hljs-value">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
        <span class="hljs-attribute">xmlns:local</span>=<span class="hljs-value">"clr-namespace:Tkani"</span>
        <span class="hljs-attribute">mc:Ignorable</span>=<span class="hljs-value">"d"</span>
        <span class="hljs-attribute">WindowStyle</span>=<span class="hljs-value">"ToolWindow"</span>
        <span class="hljs-attribute">WindowStartupLocation</span>=<span class="hljs-value">"CenterScreen"</span>
        <span class="hljs-attribute">Background</span>=<span class="hljs-value">"{StaticResource AdditionalColor}"</span>
        <span class="hljs-attribute">ResizeMode</span>=<span class="hljs-value">"NoResize"</span>
        <span class="hljs-attribute">Title</span>=<span class="hljs-value">"ООО Ткани - Вход в систему"</span> <span class="hljs-attribute">Height</span>=<span class="hljs-value">"500"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"400"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Grid</span> <span class="hljs-attribute">VerticalAlignment</span>=<span class="hljs-value">"Center"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"10 0"</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Grid.RowDefinitions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">RowDefinition</span> <span class="hljs-attribute">Height</span>=<span class="hljs-value">"180"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">RowDefinition</span> <span class="hljs-attribute">Height</span>=<span class="hljs-value">"auto"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">Grid.RowDefinitions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Image</span> <span class="hljs-attribute">Source</span>=<span class="hljs-value">"./../Images/logo.png"</span> <span class="hljs-attribute">HorizontalAlignment</span>=<span class="hljs-value">"Center"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">StackPanel</span>  <span class="hljs-attribute">Grid.Row</span>=<span class="hljs-value">"1"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Имя пользователя"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">Name</span>=<span class="hljs-value">"loginInput"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Пароль"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">PasswordBox</span> <span class="hljs-attribute">Name</span>=<span class="hljs-value">"passwordInput"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">StackPanel</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"0 10 0 25"</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaContainer"</span> <span class="hljs-attribute">Visibility</span>=<span class="hljs-value">"Ршввут"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">StackPanel</span> <span class="hljs-attribute">HorizontalAlignment</span>=<span class="hljs-value">"Center"</span> <span class="hljs-attribute">Orientation</span>=<span class="hljs-value">"Horizontal"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"1A"</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaFirstBlock"</span>
                               <span class="hljs-attribute">TextDecorations</span>=<span class="hljs-value">"Strikethrough"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"0 5 10 0"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"z8"</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaSecondBlock"</span>
                               <span class="hljs-attribute">TextDecorations</span>=<span class="hljs-value">"Strikethrough"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">StackPanel</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"Введите текст с картинки:"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">StackPanel</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Вход в систему"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">StackPanel</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
</code></pre><p>Для удобства использования поместим при создании окна фокус в поле ввода имени:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public LoginWindow()
{
    InitializeComponent();
    loginInput.Focus(); // установка фокуса
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LoginWindow</span><span class="hljs-params">()</span>
</span>{
    InitializeComponent();
    loginInput.Focus(); <span class="hljs-comment">// установка фокуса</span>
}
</code></pre><p>И сделаем так, чтобы кнопка входа срабатывала на Enter (зададим свойство <code>IsDefault</code> в <code>True</code>):</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Button IsDefault=&quot;True&quot; Content=&quot;Вход в систему&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">IsDefault</span>=<span class="hljs-value">"True"</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Вход в систему"</span> /&gt;</span>
</code></pre><p>В принципе, теперь мы готовы писать логику входа. Определим обработчик события <code>Click</code> кнопки входа. Для этого можно написать название метода внутри разметки</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Button IsDefault=&quot;True&quot; Content=&quot;Вход в систему&quot; Click=&quot;login&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">IsDefault</span>=<span class="hljs-value">"True"</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Вход в систему"</span> <span class="hljs-attribute">Click</span>=<span class="hljs-value">"login"</span> /&gt;</span>
</code></pre><p>поставить курсор(каретку) внутрь названия <code>login</code> и нажать F12. Сгенерируется метод на языке C#:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void login(object sender, RoutedEventArgs e)
{

}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{

}
</code></pre><p>Напишем код:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void login(object sender, RoutedEventArgs e)
{
    var context = new TkaniContext();
    var user = context
        .Users
        .FirstOrDefault(u =&amp;gt; u.UserLogin == loginInput.Text &amp;amp;&amp;amp; u.UserPassword == passwordInput.Password);

    if (user is null)
    {
        MessageBox.Show(&quot;Неверный логин или пароль. Проверьте введенные данные&quot;,
            &quot;Ошибка входа&quot;,
            MessageBoxButton.OK,
            MessageBoxImage.Warning);
        return;
    }

    // ниже будет логика перехода на другие окна
    MessageBox.Show(&quot;Вход успешен&quot;);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext();
    <span class="hljs-keyword">var</span> user = context
        .Users
        .FirstOrDefault(u =&gt; u.UserLogin == loginInput.Text &amp;&amp; u.UserPassword == passwordInput.Password);

    <span class="hljs-keyword">if</span> (user <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>)
    {
        MessageBox.Show(<span class="hljs-string">"Неверный логин или пароль. Проверьте введенные данные"</span>,
            <span class="hljs-string">"Ошибка входа"</span>,
            MessageBoxButton.OK,
            MessageBoxImage.Warning);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// ниже будет логика перехода на другие окна</span>
    MessageBox.Show(<span class="hljs-string">"Вход успешен"</span>);
}
</code></pre><p>В коде выше мы создаем экземпляр <code>TkaniContext</code>, после чего используем его свойство <code>Users</code>, чтобы работать с коллекцией пользователей. С помощью метода расширения Linq <code>FirstOrDefault</code> мы легко находим пользователя, удовлетворяющего заданному в скобках условию (логин и пароль равны тому, что ввел пользователь). В случае, если пользователь не будет найден, в переменной <code>user</code> будет лежать значение <code>null</code>, что легко позволяет нам сделать простую проверку и вывести сообщение об ошибке входа.</p><p>Проверьте работоспособность.</p><p>Для упрощения тестирования и отладки целесообразно временно жестко закодировать какого-нибудь пользователя в поля ввода:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;TextBox Text=&quot;8lf0g@yandex.ru&quot; Name=&quot;loginInput&quot; /&amp;gt;
...
&amp;lt;PasswordBox Password=&quot;2L6KZG&quot; Name=&quot;passwordInput&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"8lf0g@yandex.ru"</span> <span class="hljs-attribute">Name</span>=<span class="hljs-value">"loginInput"</span> /&gt;</span>
...
<span class="hljs-tag">&lt;<span class="hljs-title">PasswordBox</span> <span class="hljs-attribute">Password</span>=<span class="hljs-value">"2L6KZG"</span> <span class="hljs-attribute">Name</span>=<span class="hljs-value">"passwordInput"</span> /&gt;</span>
</code></pre><p>При неудачном входе сразу добавим генерацию captcha:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>if (user is null)
{
    MessageBox.Show(&quot;Неверный логин или пароль. Проверьте введенные данные&quot;,
        &quot;Ошибка входа&quot;, 
        MessageBoxButton.OK,
        MessageBoxImage.Warning);
    updateCaptcha();
    return;
}
</code></pre>"><span class="hljs-keyword">if</span> (user <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>)
{
    MessageBox.Show(<span class="hljs-string">"Неверный логин или пароль. Проверьте введенные данные"</span>,
        <span class="hljs-string">"Ошибка входа"</span>, 
        MessageBoxButton.OK,
        MessageBoxImage.Warning);
    updateCaptcha();
    <span class="hljs-keyword">return</span>;
}
</code></pre><p>и напишем соответствующий метод:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void updateCaptcha()
{
    const string alphabet = &quot;qwertyuiopasdfghjklzxcvbnm1234567890&quot;;

    var rng = new Random();

    captchaFirstBlock.Text = @@bodyquot;{alphabet[rng.Next(alphabet.Length)]}{alphabet[rng.Next(alphabet.Length)]}&quot;;
    captchaSecondBlock.Text = @@bodyquot;{alphabet[rng.Next(alphabet.Length)]}{alphabet[rng.Next(alphabet.Length)]}&quot;;
    captchaSecondBlock.Margin = new Thickness(0, rng.Next(-10, 10), rng.Next(-10, 10), 0);
    captchaContainer.Visibility = Visibility.Visible;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateCaptcha</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> alphabet = <span class="hljs-string">"qwertyuiopasdfghjklzxcvbnm1234567890"</span>;

    <span class="hljs-keyword">var</span> rng = <span class="hljs-keyword">new</span> Random();

    captchaFirstBlock.Text = $<span class="hljs-string">"{alphabet[rng.Next(alphabet.Length)]}{alphabet[rng.Next(alphabet.Length)]}"</span>;
    captchaSecondBlock.Text = $<span class="hljs-string">"{alphabet[rng.Next(alphabet.Length)]}{alphabet[rng.Next(alphabet.Length)]}"</span>;
    captchaSecondBlock.Margin = <span class="hljs-keyword">new</span> Thickness(<span class="hljs-number">0</span>, rng.Next(-<span class="hljs-number">10</span>, <span class="hljs-number">10</span>), rng.Next(-<span class="hljs-number">10</span>, <span class="hljs-number">10</span>), <span class="hljs-number">0</span>);
    captchaContainer.Visibility = Visibility.Visible;
}
</code></pre><p>В коде метода мы определяем набор доступных символов в переменной <code>alphabet</code> и получаем символы в коде с помощью генерации случайного индекса в строке. Также, чтобы получилось интереснее, задаем второй части капчи случайное смещение (с помощью свойства Margin).</p><p>Добавим проверку captcha в методе входа:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void login(object sender, RoutedEventArgs e)
{
    var context = new TkaniContext();

    string currentCaptcha = captchaFirstBlock.Text + captchaSecondBlock.Text;
    if (captchaInput.Text.Trim() != currentCaptcha)
    {
        MessageBox.Show(&quot;Символы с картинки введены неверно! Окно будет заблокировано&quot;,
            &quot;Ошибка входа&quot;,
            MessageBoxButton.OK,
            MessageBoxImage.Warning);
        updateCaptcha();
        return;
    }
    //...
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext();

    <span class="hljs-keyword">string</span> currentCaptcha = captchaFirstBlock.Text + captchaSecondBlock.Text;
    <span class="hljs-keyword">if</span> (captchaInput.Text.Trim() != currentCaptcha)
    {
        MessageBox.Show(<span class="hljs-string">"Символы с картинки введены неверно! Окно будет заблокировано"</span>,
            <span class="hljs-string">"Ошибка входа"</span>,
            MessageBoxButton.OK,
            MessageBoxImage.Warning);
        updateCaptcha();
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">//...</span>
</code></pre><p>Уберем значения <code>Text</code> у соответствующих элементов <code>TextBlock</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;TextBlock Text=&quot;&quot; x:Name=&quot;captchaFirstBlock&quot; 
                               TextDecorations=&quot;Strikethrough&quot; Margin=&quot;0 5 10 0&quot; /&amp;gt;
&amp;lt;TextBlock Text=&quot;&quot; x:Name=&quot;captchaSecondBlock&quot;
           TextDecorations=&quot;Strikethrough&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">""</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaFirstBlock"</span> 
                               <span class="hljs-attribute">TextDecorations</span>=<span class="hljs-value">"Strikethrough"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"0 5 10 0"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">""</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"captchaSecondBlock"</span>
           <span class="hljs-attribute">TextDecorations</span>=<span class="hljs-value">"Strikethrough"</span> /&gt;</span>
</code></pre><p>По сути, получается, что проверка captcha происходит всегда, но при первом вводе ее символы, как и символы в поле ввода, равны пустой строке. Как только будет допущена ошибка, в <code>TextBlock</code> появятся символы и пользователь будет вынужден их ввести.</p><p>Проверьте работоспособность.</p><p>Наконец, выполним блокировку окна. Сперва добавим поля</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private DispatcherTimer timer = new DispatcherTimer
{
    Interval = TimeSpan.FromSeconds(1),
    IsEnabled = false
};
private int blockTime = 10;
</code></pre>"><span class="hljs-keyword">private</span> DispatcherTimer timer = <span class="hljs-keyword">new</span> DispatcherTimer
{
    Interval = TimeSpan.FromSeconds(<span class="hljs-number">1</span>),
    IsEnabled = <span class="hljs-keyword">false</span>
};
<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> blockTime = <span class="hljs-number">10</span>;
</code></pre><p>Затем, мы назначим обработчик на событие Tick.</p><h2 id="![](68.png)"><a name="![](68.png)" href="#![](68.png)"></a><img src="68.png" alt=""></h2><p><img src="69.png" alt=""></p><p>Напишем код для таймера:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void blockWindow()
{
    IsEnabled = false;
    blockTime = 10;
    timer.Start();
}

private void unblockWindow()
{
    timer.Stop();
    IsEnabled = true;
    loginButton.Content = &quot;Вход в систему&quot;;
}

private void Timer_Tick(object? sender, EventArgs e)
{
    if (blockTime == 0)
    {
        unblockWindow();
        return;
    }

    loginButton.Content = blockTime.ToString();
    blockTime--;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blockWindow</span><span class="hljs-params">()</span>
</span>{
    IsEnabled = <span class="hljs-keyword">false</span>;
    blockTime = <span class="hljs-number">10</span>;
    timer.Start();
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unblockWindow</span><span class="hljs-params">()</span>
</span>{
    timer.Stop();
    IsEnabled = <span class="hljs-keyword">true</span>;
    loginButton.Content = <span class="hljs-string">"Вход в систему"</span>;
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Timer_Tick</span><span class="hljs-params">(<span class="hljs-keyword">object</span>? sender, EventArgs e)</span>
</span>{
    <span class="hljs-keyword">if</span> (blockTime == <span class="hljs-number">0</span>)
    {
        unblockWindow();
        <span class="hljs-keyword">return</span>;
    }

    loginButton.Content = blockTime.ToString();
    blockTime--;
}
</code></pre><p>А также вызовем блокировку окна при неверно введенной captcha:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void login(object sender, RoutedEventArgs e)
{
    var context = new TkaniContext();

    string currentCaptcha = captchaFirstBlock.Text + captchaSecondBlock.Text;
    if (captchaInput.Text.Trim() != currentCaptcha)
    {
        MessageBox.Show(&quot;Символы с картинки введены неверно! Окно будет заблокировано&quot;,
            &quot;Ошибка входа&quot;,
            MessageBoxButton.OK,
            MessageBoxImage.Warning);
        updateCaptcha();
        blockWindow();
        return;
    }
    //...
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext();

    <span class="hljs-keyword">string</span> currentCaptcha = captchaFirstBlock.Text + captchaSecondBlock.Text;
    <span class="hljs-keyword">if</span> (captchaInput.Text.Trim() != currentCaptcha)
    {
        MessageBox.Show(<span class="hljs-string">"Символы с картинки введены неверно! Окно будет заблокировано"</span>,
            <span class="hljs-string">"Ошибка входа"</span>,
            MessageBoxButton.OK,
            MessageBoxImage.Warning);
        updateCaptcha();
        blockWindow();
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">//...</span>
</code></pre><p>И при неправильном вводе логина и пароля, если captcha была показана:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>if (user is null)
{
    MessageBox.Show(&quot;Неверный логин или пароль. Проверьте введенные данные&quot;,
        &quot;Ошибка входа&quot;, 
        MessageBoxButton.OK,
        MessageBoxImage.Warning);
        if (captchaContainer.Visibility != Visibility.Hidden)
        {
            blockWindow();
        }
        updateCaptcha();
    return;
}
</code></pre>"><span class="hljs-keyword">if</span> (user <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>)
{
    MessageBox.Show(<span class="hljs-string">"Неверный логин или пароль. Проверьте введенные данные"</span>,
        <span class="hljs-string">"Ошибка входа"</span>, 
        MessageBoxButton.OK,
        MessageBoxImage.Warning);
        <span class="hljs-keyword">if</span> (captchaContainer.Visibility != Visibility.Hidden)
        {
            blockWindow();
        }
        updateCaptcha();
    <span class="hljs-keyword">return</span>;
}
</code></pre><p>Проверьте работоспособность. В случае повторного неправильного ввода логина и пароля, или ввода неверной captcha окно должно быть заблокировано на 10 секунд.</p><h3 id="дополнительно"><a name="дополнительно" href="#дополнительно"></a>Дополнительно</h3><ul>
<li>реализуйте возможность показать введенный пароль (отобразить символы по нажатию на кнопку или установки CheckBox).</li><li>увеличьте размеры шрифтов (конечно, можно банально написать на каждом элементе <code>FontSize</code>, но может быть есть какой-нибудь более быстрый способ?)</li></ul><h3 id="3.3-окно-товаров"><a name="3.3-окно-товаров" href="#3.3-окно-товаров"></a>3.3 Окно товаров</h3><p>Сверстайте окно:<br><img src="70.png" alt=""></p><p>Минимальная ширина окна 1100 пикселей.<br>Корневой компоновочный элемент - <code>DockPanel</code>.<br>Контейнеры по порядку: <code>StackPanel</code>, <code>Grid</code> (2 столбца), <code>StackPanel</code>. Каждому из контейнеров нужно задать <code>DockPanel.Dock</code> в <code>Top</code>.<br>Последним элементом идет <code>ListView</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;ListView x:Name=&quot;productsListView&quot;&amp;gt;
    &amp;lt;ListView.View&amp;gt;
        &amp;lt;GridView&amp;gt;
            &amp;lt;GridView.Columns&amp;gt;
                &amp;lt;GridViewColumn Width=&quot;200&quot; Header=&quot;Фотография&quot;&amp;gt;
                    &amp;lt;GridViewColumn.CellTemplate&amp;gt;
                        &amp;lt;DataTemplate&amp;gt;
                            &amp;lt;!--Картинка--&amp;gt;
                        &amp;lt;/DataTemplate&amp;gt;
                    &amp;lt;/GridViewColumn.CellTemplate&amp;gt;
                &amp;lt;/GridViewColumn&amp;gt;
                &amp;lt;GridViewColumn Width=&quot;500&quot; Header=&quot;Общая информация&quot;&amp;gt;
                    &amp;lt;GridViewColumn.CellTemplate&amp;gt;
                        &amp;lt;DataTemplate&amp;gt;
                            &amp;lt;!--Макет описания товара--&amp;gt;
                        &amp;lt;/DataTemplate&amp;gt;
                    &amp;lt;/GridViewColumn.CellTemplate&amp;gt;
                &amp;lt;/GridViewColumn&amp;gt;
                &amp;lt;GridViewColumn Width=&quot;150&quot; Header=&quot;Количество&quot; DisplayMemberBinding=&quot;{Binding привяжемколичество}&quot; /&amp;gt;
            &amp;lt;/GridView.Columns&amp;gt;
        &amp;lt;/GridView&amp;gt;
    &amp;lt;/ListView.View&amp;gt;
&amp;lt;/ListView&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">ListView</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"productsListView"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ListView.View</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">GridView</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">GridView.Columns</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">GridViewColumn</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"200"</span> <span class="hljs-attribute">Header</span>=<span class="hljs-value">"Фотография"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">GridViewColumn.CellTemplate</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">DataTemplate</span>&gt;</span>
                            <span class="hljs-comment">&lt;!--Картинка--&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-title">DataTemplate</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">GridViewColumn.CellTemplate</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">GridViewColumn</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">GridViewColumn</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"500"</span> <span class="hljs-attribute">Header</span>=<span class="hljs-value">"Общая информация"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">GridViewColumn.CellTemplate</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">DataTemplate</span>&gt;</span>
                            <span class="hljs-comment">&lt;!--Макет описания товара--&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-title">DataTemplate</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">GridViewColumn.CellTemplate</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">GridViewColumn</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">GridViewColumn</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"150"</span> <span class="hljs-attribute">Header</span>=<span class="hljs-value">"Количество"</span> <span class="hljs-attribute">DisplayMemberBinding</span>=<span class="hljs-value">"{Binding привяжемколичество}"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">GridView.Columns</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">GridView</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ListView.View</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ListView</span>&gt;</span>
</code></pre><p>Реализуем переход на данное окно (при успешном вводе пользовательских данных и captcha):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>ProductsWindow window = new ProductsWindow();
window.Show();
Close();
</code></pre>">ProductsWindow window = <span class="hljs-keyword">new</span> ProductsWindow();
window.Show();
Close();
</code></pre><p>Выведем данные.</p><p>Сперва зададим <code>ItemsSource</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public ProductsWindow()
{
    InitializeComponent();
    var context = new TkaniContext();
    productsListView.ItemsSource = context
        .Products
        .Include(p =&amp;gt; p.ProductManufacturerNavigation) // подкачиваем производителей (Inner Join)
        .ToList();
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ProductsWindow</span><span class="hljs-params">()</span>
</span>{
    InitializeComponent();
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext();
    productsListView.ItemsSource = context
        .Products
        .Include(p =&gt; p.ProductManufacturerNavigation) <span class="hljs-comment">// подкачиваем производителей (Inner Join)</span>
        .ToList();
}
</code></pre><p>Далее, выполним все необходимые привязки.<br>Фото:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;DataTemplate&amp;gt;
    &amp;lt;Image Source=&quot;{Binding ProductPhoto}&quot; /&amp;gt;
&amp;lt;/DataTemplate&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">DataTemplate</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Image</span> <span class="hljs-attribute">Source</span>=<span class="hljs-value">"{Binding ProductPhoto}"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">DataTemplate</span>&gt;</span>
</code></pre><p>Описание товара:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;DataTemplate&amp;gt;
    &amp;lt;TextBlock&amp;gt;
        &amp;lt;Run Text=&quot;{Binding ProductName}&quot; 
             FontSize=&quot;18&quot; FontWeight=&quot;Bold&quot; /&amp;gt;
        &amp;lt;LineBreak /&amp;gt;
        &amp;lt;Run Text=&quot;{Binding ProductDescription}&quot; /&amp;gt;
        &amp;lt;LineBreak /&amp;gt;
        Производитель: &amp;lt;Run Text=&quot;{Binding ProductManufacturer}&quot; /&amp;gt;
        &amp;lt;LineBreak /&amp;gt;
        Цена: &amp;lt;Run Text=&quot;{Binding ProductCost}&quot; /&amp;gt;
    &amp;lt;/TextBlock&amp;gt;
&amp;lt;/DataTemplate&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">DataTemplate</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductName}"</span> 
             <span class="hljs-attribute">FontSize</span>=<span class="hljs-value">"18"</span> <span class="hljs-attribute">FontWeight</span>=<span class="hljs-value">"Bold"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">LineBreak</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductDescription}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">LineBreak</span> /&gt;</span>
        Производитель: <span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductManufacturer}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">LineBreak</span> /&gt;</span>
        Цена: <span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductCost}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">TextBlock</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">DataTemplate</span>&gt;</span>
</code></pre><p>Количество:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;GridViewColumn Width=&quot;150&quot; Header=&quot;Количество&quot; DisplayMemberBinding=&quot;{Binding ProductQuantityInStock}&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">GridViewColumn</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"150"</span> <span class="hljs-attribute">Header</span>=<span class="hljs-value">"Количество"</span> <span class="hljs-attribute">DisplayMemberBinding</span>=<span class="hljs-value">"{Binding ProductQuantityInStock}"</span> /&gt;</span>
</code></pre><p>При запуске вы должны увидеть примерно следующее:<br><img src="71.png" alt=""></p><p>Внесем исправления.</p><p>Во-первых округлим цену до двух знаков после запятой с помощью <code>StringFormat</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Run Text=&quot;{Binding ProductCost, StringFormat={}{0:0.00} рублей}&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductCost, StringFormat={}{0:0.00} рублей}"</span> /&gt;</span>
</code></pre><p>(<code>{}</code> задает начало строки, дальше идет шаблон, в котором <code>{0}</code> означает само значение, а с помощью двоеточия могут быть заданы параметры конвертации в строку)</p><p>Во-вторых заставим текст переноситься на другую строку, указав значение свойству <code>TextWrapping</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;TextBlock TextWrapping=&quot;Wrap&quot;&amp;gt;
    &amp;lt;Run Text=&quot;{Binding ProductName}&quot;
         FontSize=&quot;18&quot; FontWeight=&quot;Bold&quot; /&amp;gt;
    &amp;lt;LineBreak /&amp;gt;
    ...
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">TextWrapping</span>=<span class="hljs-value">"Wrap"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductName}"</span>
         <span class="hljs-attribute">FontSize</span>=<span class="hljs-value">"18"</span> <span class="hljs-attribute">FontWeight</span>=<span class="hljs-value">"Bold"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">LineBreak</span> /&gt;</span>
    ...
</code></pre><p>В-третьих используем навигационное свойство для вывода названия производителя вместо его Id:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>Производитель: &amp;lt;Run Text=&quot;{Binding ProductManufacturerNavigation.Name}&quot; /&amp;gt;
</code></pre>">Производитель: <span class="hljs-tag">&lt;<span class="hljs-title">Run</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductManufacturerNavigation.Name}"</span> /&gt;</span>
</code></pre><p>Кстати, обратите внимание, что названия свойств ваших классов могут отличаться от тех, что в примере. Так или иначе, вам нужно указать свойство, которое будет иметь тип <code>Manufacturer</code>, а не <code>int</code>.</p><p>После всех трех изменений и пары косметических модификаций, получилось примерно следующее:<br><img src="72.png" alt=""></p><p>Выведем фотографии.</p><p>Сперва добавим файлы и зададим им копирование файлов в выходной каталог:<br><img src="73.png" alt=""></p><p>Также, на забудьте дополнительно добавить картинку-заглушку (есть в папке с ресурсами) и указать для нее все то же самое.</p><p>Затем реализуем конвертер. Для этого нужно создать класс:<br><img src="74.png" alt=""></p><p>Указать, что он реализует интерфейс <code>IValueConverter</code>:<br><img src="75.png" alt=""></p><p>С помощью быстрых действий:</p><ul>
<li>добавьте using;</li><li>используйте пункт “реализовать интерфейс”;<br><img src="76.png" alt=""><br><img src="77.png" alt=""></li></ul><p>Метод Convert</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
{
    throw new NotImplementedException();
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">Convert</span><span class="hljs-params">(<span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-keyword">object</span> parameter, CultureInfo culture)</span>
</span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
}
</code></pre><p>определяет преобразование значения value, которое будет происходить при привязке данных.</p><p>Нам нужно просто изменить путь до изображения. Реализуем метод:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
{
    var filename = value as string;
    if (string.IsNullOrEmpty(filename))
    {
        return System.IO.Path.Combine(Environment.CurrentDirectory, &quot;Images&quot;, &quot;picture.png&quot;);
    }
    return System.IO.Path.Combine(Environment.CurrentDirectory, &quot;Images&quot;, filename);
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">Convert</span><span class="hljs-params">(<span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-keyword">object</span> parameter, CultureInfo culture)</span>
</span>{
    <span class="hljs-keyword">var</span> filename = <span class="hljs-keyword">value</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">string</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(filename))
    {
        <span class="hljs-keyword">return</span> System.IO.Path.Combine(Environment.CurrentDirectory, <span class="hljs-string">"Images"</span>, <span class="hljs-string">"picture.png"</span>);
    }
    <span class="hljs-keyword">return</span> System.IO.Path.Combine(Environment.CurrentDirectory, <span class="hljs-string">"Images"</span>, filename);
}
</code></pre><p>Или, если так понятнее, то можно просто “склеить” имена (рекомендуемый подход - через класс <code>Path</code>, имеющий встроенные методы для работы с путями и именами файлов):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
{
    var filename = value as string;
    if (string.IsNullOrEmpty(filename))
    {
        return Environment.CurrentDirectory + @&quot;\Images\picture.png&quot;;
    }
    return Environment.CurrentDirectory + @&quot;\Images\&quot; + filename;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">Convert</span><span class="hljs-params">(<span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-keyword">object</span> parameter, CultureInfo culture)</span>
</span>{
    <span class="hljs-keyword">var</span> filename = <span class="hljs-keyword">value</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">string</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(filename))
    {
        <span class="hljs-keyword">return</span> Environment.CurrentDirectory + <span class="hljs-string">@"\Images\picture.png"</span>;
    }
    <span class="hljs-keyword">return</span> Environment.CurrentDirectory + <span class="hljs-string">@"\Images\"</span> + filename;
}
</code></pre><p>Далее, нужно создать экземпляр конвертера в ресурсах (создадим в app.xaml). Определяем namespace с названием <code>converters</code> (название можно выбрать произвольным):</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Application x:Class=&quot;Tkani.App&quot;
             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
             xmlns:local=&quot;clr-namespace:Tkani&quot;
             xmlns:converters=&quot;clr-namespace:Tkani.Converters&quot;
             StartupUri=&quot;Views/LoginWindow.xaml&quot;&amp;gt;
    &amp;lt;Application.Resources&amp;gt;
    ...
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Application</span> <span class="hljs-attribute">x:Class</span>=<span class="hljs-value">"Tkani.App"</span>
             <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             <span class="hljs-attribute">xmlns:x</span>=<span class="hljs-value">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
             <span class="hljs-attribute">xmlns:local</span>=<span class="hljs-value">"clr-namespace:Tkani"</span>
             <span class="hljs-attribute">xmlns:converters</span>=<span class="hljs-value">"clr-namespace:Tkani.Converters"</span>
             <span class="hljs-attribute">StartupUri</span>=<span class="hljs-value">"Views/LoginWindow.xaml"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Application.Resources</span>&gt;</span>
    ...
</code></pre><p>Используем его, чтобы определить ресурс:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Application.Resources&amp;gt;
    &amp;lt;converters:ImagePathConverter x:Key=&quot;imageConverter&quot; /&amp;gt;

    &amp;lt;!--Цвета--&amp;gt;
    &amp;lt;SolidColorBrush x:Key=&quot;BackgroudColor&quot; Color=&quot;#FFFFFF&quot; /&amp;gt;
    ...
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Application.Resources</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">converters:ImagePathConverter</span> <span class="hljs-attribute">x:Key</span>=<span class="hljs-value">"imageConverter"</span> /&gt;</span>

    <span class="hljs-comment">&lt;!--Цвета--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">SolidColorBrush</span> <span class="hljs-attribute">x:Key</span>=<span class="hljs-value">"BackgroudColor"</span> <span class="hljs-attribute">Color</span>=<span class="hljs-value">"#FFFFFF"</span> /&gt;</span>
    ...
</code></pre><p>Указываем конвертер при привязке:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Image Source=&quot;{Binding ProductPhoto, Converter={StaticResource imageConverter}}&quot; Width=&quot;180&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Image</span> <span class="hljs-attribute">Source</span>=<span class="hljs-value">"{Binding ProductPhoto, Converter={StaticResource imageConverter}}"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"180"</span> /&gt;</span>
</code></pre><p>Примерный результат:<br><img src="78.png" alt=""></p><p>Реализуем поиск. Для этого напишем обработчик события <code>TextChanged</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;TextBox x:Name=&quot;searchTextBox&quot; TextChanged=&quot;searchProduct&quot; Margin=&quot;10 5&quot; Width=&quot;150&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"searchTextBox"</span> <span class="hljs-attribute">TextChanged</span>=<span class="hljs-value">"searchProduct"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"10 5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"150"</span> /&gt;</span>
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void searchProduct(object sender, TextChangedEventArgs e)
{
//...
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">searchProduct</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, TextChangedEventArgs e)</span>
</span>{
<span class="hljs-comment">//...</span>
}
</code></pre><p>При поиске просто отправим новый запрос и получим обновленные результаты:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void searchProduct(object sender, TextChangedEventArgs e)
{
    using (var context = new TkaniContext()) // не забываем высвободить ресурсы (Dispose)
    {
        productsListView.ItemsSource = context
            .Products
            .Include(p =&amp;gt; p.ProductManufacturerNavigation) // подключаем производителей 
            .Where(p =&amp;gt; p.ProductName.Contains(searchTextBox.Text)) // фильтруем их
            .ToList();
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">searchProduct</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, TextChangedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext()) <span class="hljs-comment">// не забываем высвободить ресурсы (Dispose)</span>
    {
        productsListView.ItemsSource = context
            .Products
            .Include(p =&gt; p.ProductManufacturerNavigation) <span class="hljs-comment">// подключаем производителей </span>
            .Where(p =&gt; p.ProductName.Contains(searchTextBox.Text)) <span class="hljs-comment">// фильтруем их</span>
            .ToList();
    }
}
</code></pre><p><img src="79.png" alt=""></p><p>Реализуем фильтрацию по производителю. Имеем <code>ComboBox</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;ComboBox x:Name=&quot;filterComboBox&quot; Margin=&quot;10 5&quot; Width=&quot;150&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"filterComboBox"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"10 5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"150"</span> /&gt;</span>
</code></pre><p>Заполним его элементами:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public ProductsWindow()
{
    InitializeComponent();
    var context = new TkaniContext();
    productsListView.ItemsSource = context
        .Products
        .Include(p =&amp;gt; p.ProductManufacturerNavigation) // подключаем производителей
        .ToList();
    // производители
    var manufacturers = context.Manufacturers.ToList();
    manufacturers.Insert(0, new Manufacturer { Id = 0, Name = &quot;Все производители&quot; });
    filterComboBox.ItemsSource = manufacturers;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ProductsWindow</span><span class="hljs-params">()</span>
</span>{
    InitializeComponent();
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext();
    productsListView.ItemsSource = context
        .Products
        .Include(p =&gt; p.ProductManufacturerNavigation) <span class="hljs-comment">// подключаем производителей</span>
        .ToList();
    <span class="hljs-comment">// производители</span>
    <span class="hljs-keyword">var</span> manufacturers = context.Manufacturers.ToList();
    manufacturers.Insert(<span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> Manufacturer { Id = <span class="hljs-number">0</span>, Name = <span class="hljs-string">"Все производители"</span> });
    filterComboBox.ItemsSource = manufacturers;
}
</code></pre><p><img src="80.png" alt=""></p><p>Добиться вывода названий производителя можно либо написав <code>ItemTemplate</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;ComboBox x:Name=&quot;filterComboBox&quot; Margin=&quot;10 5&quot; Width=&quot;150&quot;&amp;gt;
    &amp;lt;ComboBox.ItemTemplate&amp;gt;
        &amp;lt;DataTemplate&amp;gt;
            &amp;lt;TextBlock Text=&quot;{Binding Name}&quot; /&amp;gt;
        &amp;lt;/DataTemplate&amp;gt;
    &amp;lt;/ComboBox.ItemTemplate&amp;gt;
&amp;lt;/ComboBox&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"filterComboBox"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"10 5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"150"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ComboBox.ItemTemplate</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">DataTemplate</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TextBlock</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding Name}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">DataTemplate</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ComboBox.ItemTemplate</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ComboBox</span>&gt;</span>
</code></pre><p>либо установив у <code>ComboBox</code> свойство <code>DisplayMemberPath</code></p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>filterComboBox.DisplayMemberPath = &quot;Name&quot;;
</code></pre>">filterComboBox.DisplayMemberPath = <span class="hljs-string">"Name"</span>;
</code></pre><p>либо переопределив у класса <code>Manufacturer</code> метод <code>ToString</code><br>(выберите что-то одно).</p><p>Реализуем фильтрацию (событие <code>SelectionChanged</code> у ComboBox):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>using (var context = new TkaniContext())
{
    var manufacturer = (Manufacturer)filterComboBox.SelectedItem; // выбранный производитель

    if (manufacturer.Id == 0) // все производители
    {
        productsListView.ItemsSource = context
            .Products
            .Include(p =&amp;gt; p.ProductManufacturerNavigation)
            .ToList();
    }
    else // производитель имеет Id в БД (какой-то производитель)
    {
        productsListView.ItemsSource = context
            .Products
            .Include(p =&amp;gt; p.ProductManufacturerNavigation)
            .Where(p =&amp;gt; p.ProductManufacturerNavigation == manufacturer)
            .ToList();
    }
}
</code></pre>"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext())
{
    <span class="hljs-keyword">var</span> manufacturer = (Manufacturer)filterComboBox.SelectedItem; <span class="hljs-comment">// выбранный производитель</span>

    <span class="hljs-keyword">if</span> (manufacturer.Id == <span class="hljs-number">0</span>) <span class="hljs-comment">// все производители</span>
    {
        productsListView.ItemsSource = context
            .Products
            .Include(p =&gt; p.ProductManufacturerNavigation)
            .ToList();
    }
    <span class="hljs-keyword">else</span> <span class="hljs-comment">// производитель имеет Id в БД (какой-то производитель)</span>
    {
        productsListView.ItemsSource = context
            .Products
            .Include(p =&gt; p.ProductManufacturerNavigation)
            .Where(p =&gt; p.ProductManufacturerNavigation == manufacturer)
            .ToList();
    }
}
</code></pre><p>Осталась сортировка.<br>Опишем <code>ComboBox</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;ComboBox x:Name=&quot;sortingComboBox&quot; Margin=&quot;10 5&quot; Width=&quot;150&quot; &amp;gt;
    &amp;lt;ComboBoxItem Content=&quot;По убыванию цены&quot; /&amp;gt;
    &amp;lt;ComboBoxItem Content=&quot;По возрастанию цены&quot; /&amp;gt;
&amp;lt;/ComboBox&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"sortingComboBox"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"10 5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"150"</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ComboBoxItem</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"По убыванию цены"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ComboBoxItem</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"По возрастанию цены"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ComboBox</span>&gt;</span>
</code></pre><p>Для него также зададим событие <code>SelectionChanged</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void sortProducts(object sender, SelectionChangedEventArgs e)
{
    using (var context = new TkaniContext())
    {
        if (sortingComboBox.SelectedIndex == 0)
        {
            productsListView.ItemsSource = context
                .Products
                .Include(p =&amp;gt; p.ProductManufacturerNavigation)
                .OrderBy(p =&amp;gt; p.ProductCost) // по возрастанию цены
                .ToList();
        }
        else if (sortingComboBox.SelectedIndex == 1)
        {
            productsListView.ItemsSource = context
                .Products
                .Include(p =&amp;gt; p.ProductManufacturerNavigation)
                .OrderByDescending(p =&amp;gt; p.ProductCost) // по убыванию цены
                .ToList();
        }
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sortProducts</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, SelectionChangedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext())
    {
        <span class="hljs-keyword">if</span> (sortingComboBox.SelectedIndex == <span class="hljs-number">0</span>)
        {
            productsListView.ItemsSource = context
                .Products
                .Include(p =&gt; p.ProductManufacturerNavigation)
                .OrderBy(p =&gt; p.ProductCost) <span class="hljs-comment">// по возрастанию цены</span>
                .ToList();
        }
        <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(sortingComboBox.SelectedIndex == <span class="hljs-number">1</span>)</span>
        </span>{
            productsListView.ItemsSource = context
                .Products
                .Include(p =&gt; p.ProductManufacturerNavigation)
                .OrderByDescending(p =&gt; p.ProductCost) <span class="hljs-comment">// по убыванию цены</span>
                .ToList();
        }
    }
}
</code></pre><p>Убедитесь в работоспособности всех трех функций.</p><h3 id="самостоятельно"><a name="самостоятельно" href="#самостоятельно"></a>Самостоятельно</h3><ul>
<li>добавьте возможность не сортировать значения;</li><li>добейтесь совместной работы поиска, фильтрации и сортировки;</li><li>добейтесь корректного вывода количества найденных записей и записей всего;</li><li>измените макет таким образом, чтобы количество выводилось в центре ячейки;</li><li>сделайте так, чтобы при старте программы, все элементы <code>ComboBox</code> не были пустыми;</li><li>реализуйте кнопку выхода, которая бы позволила вернуться на стартовое окно авторизации.</li></ul><h3 id="3.4-окно-добавления"><a name="3.4-окно-добавления" href="#3.4-окно-добавления"></a>3.4 Окно добавления</h3><p>Создадим кнопку добавления, кнопки изменения и удаления сделаем изначально недоступными:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Button Content=&quot;Добавить&quot; Margin=&quot;5&quot; Width=&quot;120&quot; /&amp;gt;
&amp;lt;Button Content=&quot;Изменить&quot; Margin=&quot;5&quot; Width=&quot;120&quot; IsEnabled=&quot;False&quot; /&amp;gt;
&amp;lt;Button Content=&quot;Удалить&quot; Margin=&quot;5&quot; Width=&quot;120&quot; IsEnabled=&quot;False&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Добавить"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"120"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Изменить"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"120"</span> <span class="hljs-attribute">IsEnabled</span>=<span class="hljs-value">"False"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Удалить"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"120"</span> <span class="hljs-attribute">IsEnabled</span>=<span class="hljs-value">"False"</span> /&gt;</span>
</code></pre><p>Далее нужно создать новое окно <code>AddProductWindow</code>:<br><img src="81.png" alt=""></p><p>И сверстать его. Примерный вид:<br><img src="82.png" alt=""></p><p>Сразу же реализуем переход по нажатию кнопки “Добавить”:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>var window = new AddProductWindow();
window.ShowDialog();
</code></pre>"><span class="hljs-keyword">var</span> window = <span class="hljs-keyword">new</span> AddProductWindow();
window.ShowDialog();
</code></pre><p>В окне добавления добавим обработчик <code>Loaded</code> (для самого Window), где выполним заполнение всех ComboBox</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>Loaded=&quot;loadWindow&quot;
</code></pre>">Loaded="loadWindow"
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void loadWindow(object sender, RoutedEventArgs e)
{
    using (var context = new TkaniContext())
    {
        unitComboBox.ItemsSource = context.Units.ToList();
        unitComboBox.DisplayMemberPath = &quot;Name&quot;;
        categoriesComboBox.ItemsSource = context.Categories.ToList();
        categoriesComboBox.DisplayMemberPath = &quot;Name&quot;;
        suppliersComboBox.ItemsSource = context.Suppliers.ToList();
        suppliersComboBox.DisplayMemberPath = &quot;Name&quot;;
        manufacturerComboBox.ItemsSource = context.Manufacturers.ToList();
        manufacturerComboBox.DisplayMemberPath = &quot;Name&quot;;
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadWindow</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext())
    {
        unitComboBox.ItemsSource = context.Units.ToList();
        unitComboBox.DisplayMemberPath = <span class="hljs-string">"Name"</span>;
        categoriesComboBox.ItemsSource = context.Categories.ToList();
        categoriesComboBox.DisplayMemberPath = <span class="hljs-string">"Name"</span>;
        suppliersComboBox.ItemsSource = context.Suppliers.ToList();
        suppliersComboBox.DisplayMemberPath = <span class="hljs-string">"Name"</span>;
        manufacturerComboBox.ItemsSource = context.Manufacturers.ToList();
        manufacturerComboBox.DisplayMemberPath = <span class="hljs-string">"Name"</span>;
    }
}
</code></pre><p>В конструкторе зададим контекст привязки и спрячем поле Id:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public AddProductWindow()
{
    InitializeComponent();
    currentProduct = new Product();
    DataContext = currentProduct;
    idLabel.Visibility = Visibility.Collapsed;
    idTextBox.Visibility = Visibility.Collapsed;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddProductWindow</span><span class="hljs-params">()</span>
</span>{
    InitializeComponent();
    currentProduct = <span class="hljs-keyword">new</span> Product();
    DataContext = currentProduct;
    idLabel.Visibility = Visibility.Collapsed;
    idTextBox.Visibility = Visibility.Collapsed;
}
</code></pre><p>Здесь и ниже <code>currentProduct</code> - это приватное поле типа <code>Product</code>.</p><p>Добавим еще один конструктор, чтобы в будущем окно могло также работать для изменения:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public AddProductWindow(Product product)
{
    InitializeComponent();
    currentProduct = product;
    DataContext = currentProduct;
    idTextBox.IsReadOnly = true;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AddProductWindow</span><span class="hljs-params">(Product product)</span>
</span>{
    InitializeComponent();
    currentProduct = product;
    DataContext = currentProduct;
    idTextBox.IsReadOnly = <span class="hljs-keyword">true</span>;
}
</code></pre><p>Выполним привязку. Пропишем везде соответствующие свойства. Примерный код:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Label Content=&quot;Id:&quot; Name=&quot;idLabel&quot; /&amp;gt;
&amp;lt;TextBox x:Name=&quot;idTextBox&quot; Text=&quot;{Binding ProductId}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Артикул:&quot; /&amp;gt;
&amp;lt;TextBox Text=&quot;{Binding ProductArticleNumber}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Наименование:&quot; /&amp;gt;
&amp;lt;TextBox Text=&quot;{Binding ProductName}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Количество:&quot; /&amp;gt;
&amp;lt;TextBox Text=&quot;{Binding ProductQuantityInStock}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Единица измерения:&quot; /&amp;gt;
&amp;lt;ComboBox x:Name=&quot;unitComboBox&quot; SelectedItem=&quot;{Binding ProductUnitNavigation}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Категория:&quot; /&amp;gt;
&amp;lt;ComboBox x:Name=&quot;categoriesComboBox&quot; SelectedItem=&quot;{Binding ProductCategoryNavigation}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Поставщик:&quot; /&amp;gt;
&amp;lt;ComboBox x:Name=&quot;suppliersComboBox&quot; SelectedItem=&quot;{Binding ProductSupplierNavigation}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Производитель:&quot; /&amp;gt;
&amp;lt;ComboBox x:Name=&quot;manufacturerComboBox&quot; SelectedItem=&quot;{Binding ProductManufacturerNavigation}&quot; /&amp;gt;
&amp;lt;Label Content=&quot;Стоимость:&quot; /&amp;gt;
&amp;lt;TextBox Text=&quot;{Binding ProductCost}&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Id:"</span> <span class="hljs-attribute">Name</span>=<span class="hljs-value">"idLabel"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"idTextBox"</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductId}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Артикул:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductArticleNumber}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Наименование:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductName}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Количество:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductQuantityInStock}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Единица измерения:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"unitComboBox"</span> <span class="hljs-attribute">SelectedItem</span>=<span class="hljs-value">"{Binding ProductUnitNavigation}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Категория:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"categoriesComboBox"</span> <span class="hljs-attribute">SelectedItem</span>=<span class="hljs-value">"{Binding ProductCategoryNavigation}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Поставщик:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"suppliersComboBox"</span> <span class="hljs-attribute">SelectedItem</span>=<span class="hljs-value">"{Binding ProductSupplierNavigation}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Производитель:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">ComboBox</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"manufacturerComboBox"</span> <span class="hljs-attribute">SelectedItem</span>=<span class="hljs-value">"{Binding ProductManufacturerNavigation}"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Стоимость:"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">TextBox</span> <span class="hljs-attribute">Text</span>=<span class="hljs-value">"{Binding ProductCost}"</span> /&gt;</span>
</code></pre><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Image Margin=&quot;3&quot; Source=&quot;{Binding ProductPhoto,Converter={StaticResource imageConverter}}&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Image</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"3"</span> <span class="hljs-attribute">Source</span>=<span class="hljs-value">"{Binding ProductPhoto,Converter={StaticResource imageConverter}}"</span> /&gt;</span>
</code></pre><p>Обратите внимание на следующее:</p><ul>
<li>у вас названия свойств могут отличаться;</li><li>возможно, что вам будет необходимо также добавить размер скидки (у меня это поле является необязательным);</li><li>возможно, что вам сразу придется добавить поле с описанием товара (у меня это поле является необязательным);</li></ul><p>Запустите и проверьте, что отсутствуют ошибки привязки.</p><p>Далее, выполним переход на данное окно из окна списка продуктов по нажатию кнопки изменения.</p><p>Сперва изменим свойтсва <code>ListView</code> и добавим обработчик:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;ListView x:Name=&quot;productsListView&quot; SelectionMode=&quot;Single&quot; SelectionChanged=&quot;checkSelection&quot;&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">ListView</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"productsListView"</span> <span class="hljs-attribute">SelectionMode</span>=<span class="hljs-value">"Single"</span> <span class="hljs-attribute">SelectionChanged</span>=<span class="hljs-value">"checkSelection"</span>&gt;</span>
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void checkSelection(object sender, SelectionChangedEventArgs e)
{
    if (productsListView.SelectedItems.Count &amp;gt; 0)
    {
        updateButton.IsEnabled = true;
        deleteButton.IsEnabled = true;
    }
    else
    {
        updateButton.IsEnabled = false;
        deleteButton.IsEnabled = false;
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkSelection</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, SelectionChangedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">if</span> (productsListView.SelectedItems.Count &gt; <span class="hljs-number">0</span>)
    {
        updateButton.IsEnabled = <span class="hljs-keyword">true</span>;
        deleteButton.IsEnabled = <span class="hljs-keyword">true</span>;
    }
    <span class="hljs-keyword">else</span>
    {
        updateButton.IsEnabled = <span class="hljs-keyword">false</span>;
        deleteButton.IsEnabled = <span class="hljs-keyword">false</span>;
    }
}
</code></pre><p>или можно упростить:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void checkSelection(object sender, SelectionChangedEventArgs e)
{
    bool hasSelectedItems = productsListView.SelectedItems.Count &amp;gt; 0;
    updateButton.IsEnabled = hasSelectedItems;
    deleteButton.IsEnabled = hasSelectedItems;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">checkSelection</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, SelectionChangedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">bool</span> hasSelectedItems = productsListView.SelectedItems.Count &gt; <span class="hljs-number">0</span>;
    updateButton.IsEnabled = hasSelectedItems;
    deleteButton.IsEnabled = hasSelectedItems;
}
</code></pre><p>Далее, опишем обработчик нажатия на кнопку изменить:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Button Content=&quot;Изменить&quot; Click=&quot;updateProduct&quot; x:Name=&quot;updateButton&quot; Margin=&quot;5&quot; Width=&quot;120&quot; IsEnabled=&quot;False&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Изменить"</span> <span class="hljs-attribute">Click</span>=<span class="hljs-value">"updateProduct"</span> <span class="hljs-attribute">x:Name</span>=<span class="hljs-value">"updateButton"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"5"</span> <span class="hljs-attribute">Width</span>=<span class="hljs-value">"120"</span> <span class="hljs-attribute">IsEnabled</span>=<span class="hljs-value">"False"</span> /&gt;</span>
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void updateProduct(object sender, RoutedEventArgs e)
{
    Product? selectedProduct = productsListView.SelectedItem as Product;
    if (selectedProduct is not null)
    {
        var window = new AddProductWindow(selectedProduct);
        window.ShowDialog();
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateProduct</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    Product? selectedProduct = productsListView.SelectedItem <span class="hljs-keyword">as</span> Product;
    <span class="hljs-keyword">if</span> (selectedProduct <span class="hljs-keyword">is</span> not <span class="hljs-keyword">null</span>)
    {
        <span class="hljs-keyword">var</span> window = <span class="hljs-keyword">new</span> AddProductWindow(selectedProduct);
        window.ShowDialog();
    }
}
</code></pre><p>Теперь, при нажатии на кнопку изменения, откроется окно, где будут подгружены все значения полей (кроме ComboBox).</p><p><img src="83.png" alt=""></p><p>Наконец, реализуем сохранение:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Button Content=&quot;Добавить&quot; Click=&quot;addUpdateProduct&quot; Margin=&quot;0 20 0 10&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Добавить"</span> <span class="hljs-attribute">Click</span>=<span class="hljs-value">"addUpdateProduct"</span> <span class="hljs-attribute">Margin</span>=<span class="hljs-value">"0 20 0 10"</span> /&gt;</span>
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void addUpdateProduct(object sender, RoutedEventArgs e)
{
    using (var context = new TkaniContext())
    {
        if (currentProduct.ProductId &amp;gt; 0) // изменение
        {
            context.Products.Update(currentProduct);
        }
        else
        {
            context.Products.Add(currentProduct);
        }
        context.SaveChanges();
    }
    Close();
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addUpdateProduct</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext())
    {
        <span class="hljs-keyword">if</span> (currentProduct.ProductId &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// изменение</span>
        {
            context.Products.Update(currentProduct);
        }
        <span class="hljs-keyword">else</span>
        {
            context.Products.Add(currentProduct);
        }
        context.SaveChanges();
    }
    Close();
}
</code></pre><p>На первый взгляд, если попробовать выполнить изменение, то все работает хорошо. Однако, при попытке добавления (да и при изменении) могут возникнуть ошибки. Связаны они с тем, что при вызове <code>Add</code> происходит попытка добавления, как нового продукта, так и всех связанных с ним данных (производитель, поставшик и др). Причина такого поведения заключется в том, что связанные сущности не отслеживаются контекстом, и он их распознает как просто какие-то незнакомые экземпляры классов. </p><p>В общем, чтобы поменять состояние отслеживания только у основого объекта, стоит просто написать:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>using (var context = new TkaniContext())
{
    if (currentProduct.ProductId &amp;gt; 0) // изменение
    {
        context.Products.Update(currentProduct);
    }
    else
    {
        context.Entry(currentProduct).State = EntityState.Added;
    }
    context.SaveChanges();
}
Close();
</code></pre>"><span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext())
{
    <span class="hljs-keyword">if</span> (currentProduct.ProductId &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// изменение</span>
    {
        context.Products.Update(currentProduct);
    }
    <span class="hljs-keyword">else</span>
    {
        context.Entry(currentProduct).State = EntityState.Added;
    }
    context.SaveChanges();
}
Close();
</code></pre><p>После нажатия на кнопку данные будут добавлены в БД, однако не будут обновлены в окне вывода товаров. Исправим:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void goToAddWindow(object sender, RoutedEventArgs e)
{
    var window = new AddProductWindow();
    window.ShowDialog();
    // просто выполните загрузку записей здесь, после закрытия диалогового окна
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">goToAddWindow</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-keyword">var</span> window = <span class="hljs-keyword">new</span> AddProductWindow();
    window.ShowDialog();
    <span class="hljs-comment">// просто выполните загрузку записей здесь, после закрытия диалогового окна</span>
}
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void updateProduct(object sender, RoutedEventArgs e)
{
    Product? selectedProduct = productsListView.SelectedItem as Product;
    if (selectedProduct is not null)
    {
        var window = new AddProductWindow(selectedProduct);
        window.ShowDialog();
        // и здесь
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateProduct</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    Product? selectedProduct = productsListView.SelectedItem <span class="hljs-keyword">as</span> Product;
    <span class="hljs-keyword">if</span> (selectedProduct <span class="hljs-keyword">is</span> not <span class="hljs-keyword">null</span>)
    {
        <span class="hljs-keyword">var</span> window = <span class="hljs-keyword">new</span> AddProductWindow(selectedProduct);
        window.ShowDialog();
        <span class="hljs-comment">// и здесь</span>
    }
}
</code></pre><p>Теперь выполним проверки. Один из вариантов - просто написать кучу <code>if</code> (вполне рабочий вариант, вы можете без проблем поступить именно так). Второй вариант использовать аннотации и класс <code>Validator</code>.</p><p>Сперва определим аннотации (<code>DataAnnotations</code>) для нашего типа. Получится что-то вроде:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public partial class Product
{
    public int ProductId { get; set; }

    [Required]
    [RegularExpression(&quot;[A-Z0-9]{6}&quot;)]
    public string ProductArticleNumber { get; set; } = null!;

    [Required]
    [StringLength(200, MinimumLength = 2)]
    public string ProductName { get; set; } = null!;

    public int ProductUnit { get; set; }

    public string? ProductDescription { get; set; } = null!;

    public int ProductCategory { get; set; }

    public int ProductManufacturer { get; set; }

    [Required]
    [Range(0, 1000000)]
    public decimal ProductCost { get; set; }

    public byte? ProductMaxDiscountAmount { get; set; }

    public byte? ProductDiscountAmount { get; set; }

    [Required]
    [Range(0, 10000)]
    public int ProductQuantityInStock { get; set; }

    public int? ProductSupplier { get; set; }

    public string? ProductPhoto { get; set; }

    public virtual ICollection&amp;lt;OrderProduct&amp;gt; OrderProducts { get; } = new List&amp;lt;OrderProduct&amp;gt;();

    [Required]
    public virtual Category ProductCategoryNavigation { get; set; } = null!;

    [Required]
    public virtual Manufacturer ProductManufacturerNavigation { get; set; } = null!;

    [Required]
    public virtual Supplier? ProductSupplierNavigation { get; set; }

    [Required]
    public virtual Unit ProductUnitNavigation { get; set; } = null!;
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [Required]
    [RegularExpression(<span class="hljs-string">"[A-Z0-9]{6}"</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> ProductArticleNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    [Required]
    [StringLength(<span class="hljs-number">200</span>, MinimumLength = <span class="hljs-number">2</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductUnit { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span>? ProductDescription { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductCategory { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductManufacturer { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [Required]
    [Range(<span class="hljs-number">0</span>, <span class="hljs-number">1000000</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> ProductCost { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span>? ProductMaxDiscountAmount { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span>? ProductDiscountAmount { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [Required]
    [Range(<span class="hljs-number">0</span>, <span class="hljs-number">10000</span>)]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductQuantityInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>? ProductSupplier { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span>? ProductPhoto { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> ICollection&lt;OrderProduct&gt; OrderProducts { <span class="hljs-keyword">get</span>; } = <span class="hljs-keyword">new</span> List&lt;OrderProduct&gt;();

    [Required]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Category ProductCategoryNavigation { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    [Required]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Manufacturer ProductManufacturerNavigation { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;

    [Required]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Supplier? ProductSupplierNavigation { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [Required]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Unit ProductUnitNavigation { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">null</span>!;
}
</code></pre><p>Далее, добавим проверку:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void addUpdateProduct(object sender, RoutedEventArgs e)
{
    // создаем контекст валидации
    var validationContext = new ValidationContext(currentProduct);
    // список ошибок
    var results = new List&amp;lt;System.ComponentModel.DataAnnotations.ValidationResult&amp;gt;();
    // вызываем метод класс Validator - TryValidateObject
    // true для полной проверки
    var isValid = Validator.TryValidateObject(currentProduct, validationContext, results, true);

    // если объект не валидный
    if (!isValid)
    {
        errorsLabel.Content = string.Empty;
        // то выводим все сообщения в специальный label
        // (между полями ввода и кнопкой &quot;добавить&quot;)
        foreach (var error in results)
        {
            errorsLabel.Content += error.ErrorMessage + &quot;\r\n&quot;;
        }
        return;
    }


    using (var context = new TkaniContext())
    {
        if (currentProduct.ProductId &amp;gt; 0) // изменение
        {
            context.Products.Update(currentProduct);
        }
        else
        {
            context.Entry(currentProduct).State = EntityState.Added;
        }
        context.SaveChanges();
    }
    Close();
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addUpdateProduct</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    <span class="hljs-comment">// создаем контекст валидации</span>
    <span class="hljs-keyword">var</span> validationContext = <span class="hljs-keyword">new</span> ValidationContext(currentProduct);
    <span class="hljs-comment">// список ошибок</span>
    <span class="hljs-keyword">var</span> results = <span class="hljs-keyword">new</span> List&lt;System.ComponentModel.DataAnnotations.ValidationResult&gt;();
    <span class="hljs-comment">// вызываем метод класс Validator - TryValidateObject</span>
    <span class="hljs-comment">// true для полной проверки</span>
    <span class="hljs-keyword">var</span> isValid = Validator.TryValidateObject(currentProduct, validationContext, results, <span class="hljs-keyword">true</span>);

    <span class="hljs-comment">// если объект не валидный</span>
    <span class="hljs-keyword">if</span> (!isValid)
    {
        errorsLabel.Content = <span class="hljs-keyword">string</span>.Empty;
        <span class="hljs-comment">// то выводим все сообщения в специальный label</span>
        <span class="hljs-comment">// (между полями ввода и кнопкой "добавить")</span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> error <span class="hljs-keyword">in</span> results)
        {
            errorsLabel.Content += error.ErrorMessage + <span class="hljs-string">"\r\n"</span>;
        }
        <span class="hljs-keyword">return</span>;
    }


    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> TkaniContext())
    {
        <span class="hljs-keyword">if</span> (currentProduct.ProductId &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// изменение</span>
        {
            context.Products.Update(currentProduct);
        }
        <span class="hljs-keyword">else</span>
        {
            context.Entry(currentProduct).State = EntityState.Added;
        }
        context.SaveChanges();
    }
    Close();
}
</code></pre><p>Примерный результат:<br><img src="84.png" alt=""></p><p>Если хотите изменить текст сообщений, то используйте при объявлении аннотаций специальный параметр <code>ErrorMessage</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>[Required(ErrorMessage = &quot;Стоимость товара является обязательной&quot;)]
[Range(0, 1000000, ErrorMessage = &quot;Укажите стоимость товара в диапазоне от 0 до 1.000.000&quot;)]
public decimal ProductCost { get; set; }
</code></pre>">[Required(ErrorMessage = <span class="hljs-string">"Стоимость товара является обязательной"</span>)]
[Range(<span class="hljs-number">0</span>, <span class="hljs-number">1000000</span>, ErrorMessage = <span class="hljs-string">"Укажите стоимость товара в диапазоне от 0 до 1.000.000"</span>)]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">decimal</span> ProductCost { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</code></pre><p>Проверьте еще раз работоспособность (с учетом того, что все написано максимально быстро, не уверен, что все хорошо работает).</p><h3 id="самостоятельно"><a name="самостоятельно" href="#самостоятельно"></a>Самостоятельно</h3><ul>
<li>добавьте в окне авторизации кнопку гостевого входа;</li><li>в случае, если зашел гость или пользователь, не являющийся администратором, скройте панель с кнопками “добавить”, “изменить” и “удалить”;</li><li>используя код перехода на окно изменения, реализуйте удаление товара. Перед удалением выведите диалоговое окно (<code>MessageBox.Show</code>) с вопросом “Вы уверены, что хотите удалить продукт?”. Для удаления могут быть полезными такие методы <code>DbSet</code> (внутри вашего контекста) как <code>Find</code>, <code>Remove</code> и <code>SaveChanges</code>;</li><li>измените внешний вид окна (заголовок и название кнопок) в зависимости от того, добавление это или изменение;</li><li>установите фокус в поле названия товара сразу после открытия окна добавления/изменения (исп. метод <code>SetFocus</code>);</li><li>реализуйте кнопку “Отменить” в окне добавления/изменения, установите кнопкам “Добавить” и “Отменить” значения свойств <code>IsDefault</code> и <code>IsCancel</code> соответственно (первая будет работать на Enter, вторая на Esc);</li><li>добавьте в окно добавления многострочное поле с описанием товара;</li><li>добейтесь того, чтобы при открытии окна изменения, все значения также подгружались и в ComboBox.</li></ul><h3 id="3.5-изменение-изображения"><a name="3.5-изменение-изображения" href="#3.5-изменение-изображения"></a>3.5 Изменение изображения</h3><p>Реализуем изменение/добавление изображения. </p><p>Во-первых, необходимо создать обработчик события <code>Click</code> для кнопки “Изменить изображение”:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;Button Grid.Row=&quot;1&quot; VerticalAlignment=&quot;Top&quot; Content=&quot;Изменить изображение&quot; Click=&quot;updatePhoto&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">Grid.Row</span>=<span class="hljs-value">"1"</span> <span class="hljs-attribute">VerticalAlignment</span>=<span class="hljs-value">"Top"</span> <span class="hljs-attribute">Content</span>=<span class="hljs-value">"Изменить изображение"</span> <span class="hljs-attribute">Click</span>=<span class="hljs-value">"updatePhoto"</span> /&gt;</span>
</code></pre><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void updatePhoto(object sender, RoutedEventArgs e)
{

}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updatePhoto</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{

}
</code></pre><p>Во-вторых, по нажатию кнопки вызовем диалоговое окно:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void updatePhoto(object sender, RoutedEventArgs e)
{
    OpenFileDialog dialog = new OpenFileDialog
    {
        Filter = &quot;Изображения PNG|*.png&quot;,
        Title = &quot;Выбор изображения&quot;
    };

    if (dialog.ShowDialog() == true) // если было выбрано изображение
    {
        // ..
    }

}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updatePhoto</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    OpenFileDialog dialog = <span class="hljs-keyword">new</span> OpenFileDialog
    {
        Filter = <span class="hljs-string">"Изображения PNG|*.png"</span>,
        Title = <span class="hljs-string">"Выбор изображения"</span>
    };

    <span class="hljs-keyword">if</span> (dialog.ShowDialog() == <span class="hljs-keyword">true</span>) <span class="hljs-comment">// если было выбрано изображение</span>
    {
        <span class="hljs-comment">// ..</span>
    }

}
</code></pre><p>В-третьих напишем логику. Будем использовать классы <code>System.IO.Path</code> и <code>System.IO.File</code>:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>private void updatePhoto(object sender, RoutedEventArgs e)
{
    OpenFileDialog dialog = new OpenFileDialog
    {
        Filter = &quot;Изображения PNG|*.png&quot;,
        Title = &quot;Выбор изображения&quot;
    };

    if (dialog.ShowDialog() == true) // если было выбрано изображение
    {
        var newPhotoName = Path.GetRandomFileName() + &quot;.png&quot;; // случайное имя файла abcde.png
        var selectedPhoto = dialog.FileName; // полный путь до выбранного пользователем изображения
        var newPhotoFullName = Path.Combine(Environment.CurrentDirectory, &quot;Images&quot;, newPhotoName); // полный путь для нового изображения

        File.Copy(selectedPhoto, newPhotoFullName); // копируем файл в каталог с изображениями
        currentProduct.ProductPhoto = newPhotoName; // изменяем фотографию, работает привязка

        // сбросим контекст, чтобы фотография в окне сразу обновилась
        DataContext = null;
        DataContext = currentProduct;
    }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updatePhoto</span><span class="hljs-params">(<span class="hljs-keyword">object</span> sender, RoutedEventArgs e)</span>
</span>{
    OpenFileDialog dialog = <span class="hljs-keyword">new</span> OpenFileDialog
    {
        Filter = <span class="hljs-string">"Изображения PNG|*.png"</span>,
        Title = <span class="hljs-string">"Выбор изображения"</span>
    };

    <span class="hljs-keyword">if</span> (dialog.ShowDialog() == <span class="hljs-keyword">true</span>) <span class="hljs-comment">// если было выбрано изображение</span>
    {
        <span class="hljs-keyword">var</span> newPhotoName = Path.GetRandomFileName() + <span class="hljs-string">".png"</span>; <span class="hljs-comment">// случайное имя файла abcde.png</span>
        <span class="hljs-keyword">var</span> selectedPhoto = dialog.FileName; <span class="hljs-comment">// полный путь до выбранного пользователем изображения</span>
        <span class="hljs-keyword">var</span> newPhotoFullName = Path.Combine(Environment.CurrentDirectory, <span class="hljs-string">"Images"</span>, newPhotoName); <span class="hljs-comment">// полный путь для нового изображения</span>

        File.Copy(selectedPhoto, newPhotoFullName); <span class="hljs-comment">// копируем файл в каталог с изображениями</span>
        currentProduct.ProductPhoto = newPhotoName; <span class="hljs-comment">// изменяем фотографию, работает привязка</span>

        <span class="hljs-comment">// сбросим контекст, чтобы фотография в окне сразу обновилась</span>
        DataContext = <span class="hljs-keyword">null</span>;
        DataContext = currentProduct;
    }
}
</code></pre><p>В целом, добавление изображения после этого должно корректно работать.</p><h3 id="самостоятельно"><a name="самостоятельно" href="#самостоятельно"></a>Самостоятельно</h3><ul>
<li>реализуйте удаление файла при замене изображения;</li><li>реализуйте удаление файла (или измените логику добавления) при нажатии на кнопку “Отмена”; </li><li>реализуйте проверку размеров изображения;</li></ul><h3 id="3.6-выделение-записей-серым-цветом"><a name="3.6-выделение-записей-серым-цветом" href="#3.6-выделение-записей-серым-цветом"></a>3.6 Выделение записей серым цветом</h3><p>Вернемся к окну вывода товаров.</p><p>По заданию необходимо следующее:</p><blockquote>
<p>Товары, которых нет на складе, должны отображаться на сером фоне. </p>
</blockquote><p>Реализуем данную функциональность с помощью конвертера. Сперва добавим класс (в папку/пространство имен <code>Converters</code>):</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public class CountToBrushConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
}
</code></pre>"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CountToBrushConverter</span> : <span class="hljs-title">IValueConverter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">Convert</span><span class="hljs-params">(<span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-keyword">object</span> parameter, CultureInfo culture)</span>
    </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">ConvertBack</span><span class="hljs-params">(<span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-keyword">object</span> parameter, CultureInfo culture)</span>
    </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotImplementedException();
    }
}
</code></pre><p>Далее напишем логику:</p><pre class="cs hljs"><code class="cs" data-origin="<pre><code class=&quot;cs&quot;>public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
{
    var count = (int)value;
    if (count == 0)
    {
        return Brushes.Gray;
    }
    return Brushes.Transparent;
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">Convert</span><span class="hljs-params">(<span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span>, Type targetType, <span class="hljs-keyword">object</span> parameter, CultureInfo culture)</span>
</span>{
    <span class="hljs-keyword">var</span> count = (<span class="hljs-keyword">int</span>)<span class="hljs-keyword">value</span>;
    <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>)
    {
        <span class="hljs-keyword">return</span> Brushes.Gray;
    }
    <span class="hljs-keyword">return</span> Brushes.Transparent;
}
</code></pre><p>Добавим конвертер в ресурсы:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;converters:CountToBrushConverter x:Key=&quot;countConverter&quot; /&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">converters:CountToBrushConverter</span> <span class="hljs-attribute">x:Key</span>=<span class="hljs-value">"countConverter"</span> /&gt;</span>
</code></pre><p>Определим стиль для строки внутри <code>ListView</code>:</p><pre class="xml hljs"><code class="xml" data-origin="<pre><code class=&quot;xml&quot;>&amp;lt;ListView.ItemContainerStyle&amp;gt;
    &amp;lt;Style TargetType=&quot;ListViewItem&quot;&amp;gt;
        &amp;lt;Setter Property=&quot;Background&quot; Value=&quot;{Binding ProductQuantityInStock, Converter={StaticResource countConverter}}&quot; /&amp;gt;
    &amp;lt;/Style&amp;gt;
&amp;lt;/ListView.ItemContainerStyle&amp;gt;
</code></pre>"><span class="hljs-tag">&lt;<span class="hljs-title">ListView.ItemContainerStyle</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Style</span> <span class="hljs-attribute">TargetType</span>=<span class="hljs-value">"ListViewItem"</span>&gt;</span><span class="css">
        &lt;<span class="hljs-tag">Setter</span> <span class="hljs-tag">Property</span>="<span class="hljs-tag">Background</span>" <span class="hljs-tag">Value</span>="<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">Binding ProductQuantityInStock, Converter={StaticResource countConverter}}" /&gt;
    </span></span></span></span><span class="hljs-tag">&lt;/<span class="hljs-title">Style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ListView.ItemContainerStyle</span>&gt;</span>
</code></pre><p>Готово! Проверьте работоспособность.</p><h3 id="самостоятельно"><a name="самостоятельно" href="#самостоятельно"></a>Самостоятельно</h3><ul>
<li>проверьте по заданию, не забыли ли мы что-то сделать. При необходимости реализуйте недостающие функции.</li></ul><h3 id="4.-разработка-библиотеки"><a name="4.-разработка-библиотеки" href="#4.-разработка-библиотеки"></a>4. Разработка библиотеки</h3><p>Разработайте библиотеку классов согласно заданию. Выполните следующее:</p><ul>
<li>добавьте проект библиотеки классов в решение (учтите, что вам нужно выбрать платформу, соответствующую вашему проекту);</li><li>дайте проекту название, соответствующее заданию;</li><li>добавьте в библиотеку класс, опишите в нем метод с правильной сигнатурой.</li></ul><p>В целом, этого хватит, чтобы получить большую часть баллов.</p><h3 id="дополнительно"><a name="дополнительно" href="#дополнительно"></a>Дополнительно</h3><p>Реализуйте алгоритм согласно заданию.</p><h3 id="5.-разработка-тестового-проекта"><a name="5.-разработка-тестового-проекта" href="#5.-разработка-тестового-проекта"></a>5. Разработка тестового проекта</h3><p>Добавьте в решение проект модульных тестов (NUnit или MsTest). Выполните после этого следующее:</p><ul>
<li>переименуйте класс (дайте описательное название, закончите его словом <code>Tests</code>; например, подойте <code>CalculationsTests</code>);</li><li>добавьте ссылку на проект библиотеки классов;</li></ul><h3 id="дополнительно"><a name="дополнительно" href="#дополнительно"></a>Дополнительно</h3><p>Напишите 10 модульных тестов для проверки алгоритма из пункта 4.</p><h3 id="6.-составление-тестовой-документации"><a name="6.-составление-тестовой-документации" href="#6.-составление-тестовой-документации"></a>6. Составление тестовой документации</h3><p>Заполните тестовые формы (см. шаблон в папке с заданием). Обратите внимание, что вам нужно протестировать только добавление товара. Обратите внимание на раздел документа “Расшифровка тестовых информационных полей”.</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
